 R←Test_API_130(stopFlag batchFlag);⎕TRAP;was;fn2;fn1
⍝ Runs "CompareCommits"
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←T._Failed

 :If batchFlag
     →0,R←T._NoBatchTest
 :EndIf
 :If 0=⎕SE.⎕NC'CompareFiles'
     →0,R←T._NotApplicable
 :EndIf

 ⎕←' This test needs you: it will run the command ]CompareCommits which will use an external utiliy, BeyondCompare,'
 ⎕←' (which needs to be installed and accessible on the PATH environment variable) via the ]CompareFiles user command'
 :If 0=∆YesOrNo' Would you like to run this test?'
     →0,R←T._Inactive
 :EndIf

 was←⎕SE._CompareFiles.INI.Default
 ⎕SE._CompareFiles.INI.Default←'BeyondCompare'

 (fn1 fn2)←##.APLGit2.CompareCommits'main' 'dev'

 →T.GoToTidyUp~∧/⎕NEXISTS fn1 fn2
 →T.GoToTidyUp 0=1 ∆YesOrNo'Did "BeyondCompare" show up?'

 R←T._OK

∆TidyUp:
 ⎕SE._CompareFiles.INI.Default←was
 :Trap 0 ⋄ FilesAndDirs.DeleteFile fn1 ⋄ :EndTrap
 :Trap 0 ⋄ FilesAndDirs.DeleteFile fn2 ⋄ :EndTrap
⍝Done

<!DOCTYPE html>
<html lang="en">
<head>
<title>Coverage</title>
<meta charset="utf-8"/>
<style>
@media screen{
    html {background-color: #FFFFF0;}
body {
    font-size: 16px;
    font-family : Verdana, "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
    margin: 1em;
}
th, td {padding: 5px 10px;}
th {text-align: left;}
h1, h2, h3, h4, h5, h6 {color: #424242;}
h1 {font-size: 22px;}
h2 {font-size: 18px; margin-top: 2em; margin-bottom:0.3em;}
tbody tr:nth-child(even) {background-color: #F0F0F0;}
tbody tr:nth-child(odd) {background-color: #FAFAFA;}
th {background-color: #E6E6E6;color: #424242;}
table {border: silver 1px solid; font-size: 14px;font-family: APLFont, monospace;}
code , code a {font-size: 14px; font-family: APLFont, monospace;}
code.header {
    font-size: 16px; 
    font-family: APLFont, monospace; 
    margin: 1.5em 0.5em 0 0.5em; 
    padding:0;
    display: block;
}
div.code-block {
    border: 1px silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 0.5em 0.5em 0.5em 0.5em;
    padding: 0.5em;
}
div.code-block.missing {
    background-color: #fa605254;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
ul li, ol li {margin: 0.7em 0.2em;}
.float-right {float:right;}
.no-underline {    text-decoration :none;}
.top-links {font-size:20px; padding-left: 0.6em;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5px; padding-top:0; font-size: 9px;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 0.5em; padding: 0.5em;}
}
@media print{@page {size: portrait}
@page {
    margin: 1cm 1cm 1cm 1.75cm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
  }
}
body {
    font: 12pt "Times New Roman", Times, serif;
    line-height: 1.2;
     /* CSS3 filter, at the moment Webkit only. Prefix it for future implementations */
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%); /* future-proof */
}
h1 {font-size: 18pt;}
h2 {font-size: 16pt; margin-top: 10pt; margin-bottom: 3pt;}
th, td {padding: 2pt 3pt;}
th {text-align: left;background-color: #DBDBDB;}
tbody tr:nth-child(odd) {background-color: #EDEDED;}
table {
    color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    font-size: 8pt;
    font-family: APLFont, monospace;
}
div.keep-together {break-inside: avoid; break-before:auto;}
table {border: silver 1pt solid;}
code , code a {font-size: 8pt; font-family: APLFont, monospace;}
code.header {
    font-size: 8pt;
    font-family: APLFont, monospace;
    margin: 7pt 3pt 0 10pt;
    padding:0;
    display: block;
}
div.code-block {
    border: 1pt silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 4pt 4pt 4pt 4pt;
    padding: 4pt;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
a {text-decoration: none;color: black;}
ul li, ol li {margin: 8pt 3pt;}
.no-print {display:none;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5pt; padding-top:0; font-size: 6pt;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 8px; padding: 8px;}
}
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.js"></script>
</head>
<body>
<h1 id="top">Coverage Report</h1>
<p>Watched: 81 fns/opr within <code>#.APLGit2.APLGit2</code></p>
<p>The test suite was executed 3 times:</p>
<table>
<thead>
<tr><th>Executed at</th><th>APLVersion</th><th>Memory (MB)</th></tr>
</thead>
<tbody>
<tr><td>2023-04-11 18:30:20</td><td>Windows-64 ⋄ 18.2.46856.0 ⋄ W ⋄ Development ⋄ Unicode</td><td>52</td></tr>
<tr><td>2023-04-11 18:32:35</td><td>Linux-64 ⋄ 18.2.46656.0 ⋄ S ⋄ Development ⋄ Unicode</td><td>245</td></tr>
<tr><td>2023-04-11 18:36:05</td><td>Mac-64 ⋄ 18.2.46881.0 ⋄ S ⋄ Development ⋄ Unicode</td><td>245</td></tr>
</tbody>
</table>
<p>Overall 80% of the testable code is covered.</p>
<p>(Comment lines, empty lines, all <code>:End</code>* lines etc. are ignored)</p>
<p>53 of the fns/opr are 100% covered.</p>
<div id="partly-covered" class="keep-together">
<table id="percent">
<thead>
<tr><th style="text-align:left;">Function/Operator</th><th style="text-align:left;">Lines not executed</th><th style="text-align:left;">Coverage</th><th style="text-align:right;">≢</th></tr>
</thead>
<tbody>
<tr class="uncovered"><td><a href="#listing_1" title="Link to listing">#.APLGit2.APLGit2.GetAllObjectNamesFromWorkingArea</a></td><td>14←≢5-15,17-19</td><td>0</td><td>14</td></tr>
<tr class="uncovered"><td><a href="#listing_2" title="Link to listing">#.APLGit2.APLGit2.InitializeGitUserCommand</a></td><td>4←≢2-5</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_3" title="Link to listing">#.APLGit2.APLGit2.API.IsGitInstalled</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_4" title="Link to listing">#.APLGit2.APLGit2.API.Methods</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_5" title="Link to listing">#.APLGit2.APLGit2.API.Version</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr><td><a href="#listing_6" title="Link to listing">#.APLGit2.APLGit2.Init</a></td><td>14←≢14-19,24,31-37</td><td>39</td><td>23</td></tr>
<tr><td><a href="#listing_7" title="Link to listing">#.APLGit2.APLGit2.GoToGitHub</a></td><td>9←≢12-14,16-17,19-21,26</td><td>47</td><td>17</td></tr>
<tr><td><a href="#listing_8" title="Link to listing">#.APLGit2.APLGit2.CompareCommits_</a></td><td>23←≢8-12,14-15,25,30-34,36-37,43-45,47,54-57</td><td>48</td><td>44</td></tr>
<tr><td><a href="#listing_9" title="Link to listing">#.APLGit2.APLGit2.DiffBranches</a></td><td>11←≢5,13-15,18-23,25</td><td>52</td><td>23</td></tr>
<tr><td><a href="#listing_10" title="Link to listing">#.APLGit2.APLGit2.Squash</a></td><td>19←≢24-25,47-55,57-58,62-65,67-68</td><td>62</td><td>50</td></tr>
<tr><td><a href="#listing_11" title="Link to listing">#.APLGit2.APLGit2.SetDefaultProject</a></td><td>9←≢14,17,21-24,28-29,37</td><td>63</td><td>24</td></tr>
<tr><td><a href="#listing_12" title="Link to listing">#.APLGit2.APLGit2.LatestRelease</a></td><td>4←≢11-12,15,18</td><td>69</td><td>13</td></tr>
<tr><td><a href="#listing_13" title="Link to listing">#.APLGit2.APLGit2.GetTagOfLatestRelease</a></td><td>4←≢10-11,17,23</td><td>71</td><td>14</td></tr>
<tr><td><a href="#listing_14" title="Link to listing">#.APLGit2.APLGit2.EstablishProject</a></td><td>7←≢19,21,23-26,28</td><td>75</td><td>28</td></tr>
<tr><td><a href="#listing_15" title="Link to listing">#.APLGit2.APLGit2.GetDefaultProject</a></td><td>5</td><td>75</td><td>4</td></tr>
<tr><td><a href="#listing_16" title="Link to listing">#.APLGit2.APLGit2.CompareCommits</a></td><td>6←≢18-19,22-23,39-40</td><td>79</td><td>28</td></tr>
<tr><td><a href="#listing_17" title="Link to listing">#.APLGit2.APLGit2.GetPathFromProject</a></td><td>7</td><td>80</td><td>5</td></tr>
<tr><td><a href="#listing_18" title="Link to listing">#.APLGit2.APLGit2.GetProjectFromPath</a></td><td>8</td><td>80</td><td>5</td></tr>
<tr><td><a href="#listing_19" title="Link to listing">#.APLGit2.APLGit2.U.RunGitCommand</a></td><td>7, 10</td><td>83</td><td>12</td></tr>
<tr><td><a href="#listing_20" title="Link to listing">#.APLGit2.APLGit2.AddGitAttributes</a></td><td>4, 15</td><td>87</td><td>15</td></tr>
<tr><td><a href="#listing_21" title="Link to listing">#.APLGit2.APLGit2.DiffBetween</a></td><td>9</td><td>88</td><td>8</td></tr>
<tr><td><a href="#listing_22" title="Link to listing">#.APLGit2.APLGit2.U.GetNumberOfCommits</a></td><td>14, 21</td><td>90</td><td>21</td></tr>
<tr><td><a href="#listing_23" title="Link to listing">#.APLGit2.APLGit2.Log</a></td><td>29, 32, 51</td><td>91</td><td>33</td></tr>
<tr><td><a href="#listing_24" title="Link to listing">#.APLGit2.APLGit2.Commit</a></td><td>21</td><td>93</td><td>14</td></tr>
<tr><td><a href="#listing_25" title="Link to listing">#.APLGit2.APLGit2.OpenGitShell</a></td><td>16</td><td>94</td><td>17</td></tr>
<tr><td><a href="#listing_26" title="Link to listing">#.APLGit2.APLGit2.ChangeLog</a></td><td>32</td><td>96</td><td>24</td></tr>
<tr><td><a href="#listing_27" title="Link to listing">#.APLGit2.APLGit2.AddGitIgnore</a></td><td>32</td><td>97</td><td>37</td></tr>
<tr><td><a href="#listing_28" title="Link to listing">#.APLGit2.APLGit2.U.RunProcess</a></td><td>49</td><td>98</td><td>47</td></tr>
<tr class="fullyCovered"><td><a href="#listing_29" title="Link to listing">#.APLGit2.APLGit2.Add</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_30" title="Link to listing">#.APLGit2.APLGit2.Branch</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_31" title="Link to listing">#.APLGit2.APLGit2.CurrentBranch</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_32" title="Link to listing">#.APLGit2.APLGit2.Diff</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_33" title="Link to listing">#.APLGit2.APLGit2.GetLastCommit</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_34" title="Link to listing">#.APLGit2.APLGit2.GetMainOrMaster</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_35" title="Link to listing">#.APLGit2.APLGit2.GetMostRecentAncestor</a></td><td></td><td>100</td><td>11</td></tr>
<tr class="fullyCovered"><td><a href="#listing_36" title="Link to listing">#.APLGit2.APLGit2.GitProjects</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_37" title="Link to listing">#.APLGit2.APLGit2.IsDirty</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_38" title="Link to listing">#.APLGit2.APLGit2.IsGitInstalled</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_39" title="Link to listing">#.APLGit2.APLGit2.IsGitProject</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_40" title="Link to listing">#.APLGit2.APLGit2.ListBranches</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_41" title="Link to listing">#.APLGit2.APLGit2.LogForBranch</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_42" title="Link to listing">#.APLGit2.APLGit2.Methods</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_43" title="Link to listing">#.APLGit2.APLGit2.Public</a></td><td></td><td>100</td><td>28</td></tr>
<tr class="fullyCovered"><td><a href="#listing_44" title="Link to listing">#.APLGit2.APLGit2.RefLog</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_45" title="Link to listing">#.APLGit2.APLGit2.Status</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_46" title="Link to listing">#.APLGit2.APLGit2.Version</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_47" title="Link to listing">#.APLGit2.APLGit2.API.Add</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_48" title="Link to listing">#.APLGit2.APLGit2.API.AddGitIgnore</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_49" title="Link to listing">#.APLGit2.APLGit2.API.Branch</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_50" title="Link to listing">#.APLGit2.APLGit2.API.ChangeLog</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_51" title="Link to listing">#.APLGit2.APLGit2.API.Commit</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_52" title="Link to listing">#.APLGit2.APLGit2.API.CompareCommits</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_53" title="Link to listing">#.APLGit2.APLGit2.API.CurrentBranch</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_54" title="Link to listing">#.APLGit2.APLGit2.API.Diff</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_55" title="Link to listing">#.APLGit2.APLGit2.API.EstablishProject</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_56" title="Link to listing">#.APLGit2.APLGit2.API.GetDefaultProject</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_57" title="Link to listing">#.APLGit2.APLGit2.API.GetPathFromProject</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_58" title="Link to listing">#.APLGit2.APLGit2.API.GetProjectFromPath</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_59" title="Link to listing">#.APLGit2.APLGit2.API.GetTagOfLatestRelease</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_60" title="Link to listing">#.APLGit2.APLGit2.API.GoToGitHub</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_61" title="Link to listing">#.APLGit2.APLGit2.API.Init</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_62" title="Link to listing">#.APLGit2.APLGit2.API.IsDirty</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_63" title="Link to listing">#.APLGit2.APLGit2.API.IsGitProject</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_64" title="Link to listing">#.APLGit2.APLGit2.API.ListBranches</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_65" title="Link to listing">#.APLGit2.APLGit2.API.Log</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_66" title="Link to listing">#.APLGit2.APLGit2.API.OpenGitShell</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_67" title="Link to listing">#.APLGit2.APLGit2.API.RefLog</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_68" title="Link to listing">#.APLGit2.APLGit2.API.SetDefaultProject</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_69" title="Link to listing">#.APLGit2.APLGit2.API.Squash</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_70" title="Link to listing">#.APLGit2.APLGit2.API.Status</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_71" title="Link to listing">#.APLGit2.APLGit2.U.AddSlash</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_72" title="Link to listing">#.APLGit2.APLGit2.U.Assert</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_73" title="Link to listing">#.APLGit2.APLGit2.U.Box</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_74" title="Link to listing">#.APLGit2.APLGit2.U.ErrNo</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_75" title="Link to listing">#.APLGit2.APLGit2.U.FormatLog</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_76" title="Link to listing">#.APLGit2.APLGit2.U.GetDateFormat</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_77" title="Link to listing">#.APLGit2.APLGit2.U.GetGitAttributes</a></td><td></td><td>100</td><td>22</td></tr>
<tr class="fullyCovered"><td><a href="#listing_78" title="Link to listing">#.APLGit2.APLGit2.U.GetLogFormat</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_79" title="Link to listing">#.APLGit2.APLGit2.U.GetValidFileExtensions</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_80" title="Link to listing">#.APLGit2.APLGit2.U.MassageMsg</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_81" title="Link to listing">#.APLGit2.APLGit2.U.SelectProject</a></td><td></td><td>100</td><td>6</td></tr>
</tbody>
</table>
</div>
<script>
$(document).ready(function() {
    var oTable;
    oTable = $("#percent").DataTable( {
        paging:   false,
        ordering: true,
        info:     true,
        fixedHeader: true,
        order: [2,"asc"],
        dom: "Bft",
        drawCallback: function( settings ) {
             var api = this.api();
             $('.header[id^="listing_"]').next().addBack().css("display","none");
             api.rows( {page:"current"} ).data().each(function(data){
              id = data[0];
              id = id.match(/"(\#.*?)"/);
              if (id){$(id[1]).next().addBack().css("display","block");}
             })
        },      
        buttons: [
        {
            text: "Partly covered (23)",
            titleAttr: "50%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^(?!(0%|100%)).*";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Uncovered (5)",
            titleAttr: "0%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^0%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Fully covered (53)",
            titleAttr: "100%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "100%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "All (81)",
            titleAttr: "all",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = ".";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
    ],
 
        columnDefs: [
            {className: "align-right", targets: [2,3]
            },
            {
                render: function ( data, type, row, meta ) {
                            return data+"%" ;        
                        },
                targets: 2
            }
        ]             
    } );
    oTable.button(0).trigger();

} );    
</script>
<h2>Listings</h2>
<code class="header" id="listing_1">#.APLGit2.APLGit2.GetAllObjectNamesFromWorkingArea &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←source GetAllObjectNamesFromWorkingArea folder</code>
<code> [1]  ⍝ Establishes which objects in the working area that got deleted, added or changed.</code>
<code> [2]  ⍝ `r` is a matrix with zero to many rows and two columns:</code>
<code> [3]  ⍝ [;1] is the fully qualified filename</code>
<code> [4]  ⍝ [;2] is the fully qualified APL name</code>
<code class="emphasize">→[5]   status←1 Status folder                        ⍝ Get Short statuses</code>
<code class="emphasize">→[6]   'Not dirty, nothing to do'U.Assert 1&lt;≢status</code>
<code class="emphasize">→[7]   r←0 2⍴''</code>
<code class="emphasize">→[8]   :If 0&lt;≢status←1↓status</code>
<code class="emphasize">→[9]       types←1⊃¨status</code>
<code class="emphasize">→[10]      deleted←(types='D')⌿status</code>
<code class="emphasize">→[11]      status←(types∊'AM')⌿status                ⍝ Keep only added and modified files</code>
<code class="emphasize">→[12]      status←3↓¨status</code>
<code class="emphasize">→[13]      r←(≢{0=≢⍵:⍵ ⋄ '/',⍵}source)↓¨status</code>
<code class="emphasize">→[14]      :If 0=≢r</code>
<code class="emphasize">→[15]          r←0 2⍴''</code>
<code> [16]      :Else</code>
<code class="emphasize">→[17]          r←(⊂(folder,{0=≢⍵:⍵ ⋄ '/',⍵}source),'/'),¨r</code>
<code class="emphasize">→[18]          names←⎕SE.Link.GetItemName¨r</code>
<code class="emphasize">→[19]          r←r,[1.5]names</code>
<code> [20]      :EndIf</code>
<code> [21]  :EndIf</code>
</div>
<code class="header" id="listing_2">#.APLGit2.APLGit2.InitializeGitUserCommand &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←InitializeGitUserCommand dummy</code>
<code> [1] ⍝ Propagate refs and set global ∆TestFlag</code>
<code class="emphasize">→[2]  r←⍬</code>
<code class="emphasize">→[3]  U.A←A←APLTreeUtils2</code>
<code class="emphasize">→[4]  U.F←F←FilesAndDirs</code>
<code class="emphasize">→[5]  ∆TestFlag←0</code>
<code> [6] ⍝Done</code>
</div>
<code class="header" id="listing_3">#.APLGit2.APLGit2.API.IsGitInstalled &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> yesNo←IsGitInstalled</code>
<code class="emphasize">→[1]  yesNo←##.IsGitInstalled</code>
</div>
<code class="header" id="listing_4">#.APLGit2.APLGit2.API.Methods &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Methods</code>
<code class="emphasize">→[1]  r←##.Methods</code>
</div>
<code class="header" id="listing_5">#.APLGit2.APLGit2.API.Version &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Version</code>
<code class="emphasize">→[1]  r←##.Version</code>
</div>
<code class="header" id="listing_6">#.APLGit2.APLGit2.Init &mdash; 39%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  path←{quiet}Init y</code>
<code> [1]  ⍝ Initialize a folder as being managed by Git.\\</code>
<code> [2]  ⍝ If the user wants to she can also add a .gitignore and/or a .gitattributes file that makes sense for APLers.\\</code>
<code> [3]  ⍝ `y` must be one of:</code>
<code> [4]  ⍝  * Empty: then `Git` tries to find an open Cider project and uses that</code>
<code> [5]  ⍝  * Fully qualfied name of a namespace of an opened Cider project</code>
<code> [6]  ⍝  * Fully qualified path to a Git-managed project\\</code>
<code> [7]  ⍝ Explicit result:\\</code>
<code> [8]  ⍝ `path` is the path to a folder that was (re-) initialized as a Git project and otherwise an empty text vector.\\</code>
<code> [9]  ⍝ The optional left argument defaults to 0. If 1 then Init does not ask any question but carries out its job,</code>
<code> [10] ⍝ including the creation of .gitignore and .gitattributes</code>
<code> [11]  quiet←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'quiet'</code>
<code> [12]  (space path)←EstablishProject y</code>
<code> [13]  :If IsGitProject path</code>
<code class="emphasize">→[14]      :If quiet</code>
<code class="emphasize">→[15]      :OrIf CommTools.YesOrNo space,' is already managed by Git; would you like to re-initialize it?'</code>
<code class="emphasize">→[16]          (rc msg buff)←path U.RunGitCommand'init'</code>
<code class="emphasize">→[17]          ('Init command files with RC=',(⍕rc),'; ',msg)U.Assert 0=rc</code>
<code class="emphasize">→[18]          quiet AddGitIgnore path</code>
<code class="emphasize">→[19]          quiet AddGitAttributes path</code>
<code> [20]      :EndIf</code>
<code> [21]  :Else</code>
<code> [22]      :If 0&lt;≢path</code>
<code> [23]          :If quiet</code>
<code class="emphasize">→[24]          :OrIf CommTools.YesOrNo'Would you like to initialize ',path,' for Git?'</code>
<code> [25]              (rc msg buff)←path U.RunGitCommand'init'</code>
<code> [26]              ('Init command files with RC=',(⍕rc),'; ',msg)U.Assert 0=rc</code>
<code> [27]              quiet AddGitAttributes path</code>
<code> [28]              {}quiet AddGitIgnore path</code>
<code> [29]          :EndIf</code>
<code> [30]      :Else</code>
<code class="emphasize">→[31]          :If quiet</code>
<code class="emphasize">→[32]          :OrIf CommTools.YesOrNo'Would you like to initialize the current directory ',F.PWD,' for Git?'</code>
<code class="emphasize">→[33]              path←F.PWD</code>
<code class="emphasize">→[34]              (rc msg buff)←path U.RunGitCommand'init'</code>
<code class="emphasize">→[35]              ('Init command files with RC=',(⍕rc),'; ',msg)U.Assert 0=rc</code>
<code class="emphasize">→[36]              quiet AddGitAttributes path</code>
<code class="emphasize">→[37]              {}quiet AddGitIgnore path</code>
<code> [38]          :EndIf</code>
<code> [39]      :EndIf</code>
<code> [40]  :EndIf</code>
<code> [41] ⍝Done</code>
</div>
<code class="header" id="listing_7">#.APLGit2.APLGit2.GoToGitHub &mdash; 47%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←GoToGitHub y</code>
<code> [1]  ⍝ Opens the homepage of the given project on GitHub.\\</code>
<code> [2]  ⍝ `y` can be either the name of a project (like "Fire") or anything that `EstablishProject`</code>
<code> [3]  ⍝ can make sense of; see `EstablishProject` for details. In the former case the current</code>
<code> [4]  ⍝ directory must be compatible with the name given.\\</code>
<code> [5]   r←⍬</code>
<code> [6]   :If '/'∊y</code>
<code> [7]       url←y</code>
<code> [8]       :If ~':'∊url</code>
<code> [9]           url←'https://github.com/',url</code>
<code> [10]      :EndIf</code>
<code> [11]  :ElseIf '['=⊃y</code>
<code class="emphasize">→[12]      :If 0=≢list←⎕SE.Cider.ListOpenProjects 1</code>
<code class="emphasize">→[13]      :OrIf (≢list)&lt;ind←list[;4]⍳⊂y~'[]'</code>
<code class="emphasize">→[14]          :Return</code>
<code> [15]      :EndIf</code>
<code class="emphasize">→[16]      ref←⍎1⊃list[ind;]</code>
<code class="emphasize">→[17]      url←ref.CiderConfig.CIDER.project_url</code>
<code> [18]  :Else</code>
<code class="emphasize">→[19]      ref←⍎y</code>
<code class="emphasize">→[20]      'Invalid argument'U.Assert 9=ref.⎕NC'CiderConfig'</code>
<code class="emphasize">→[21]      url←ref.CiderConfig.CIDER.project_url</code>
<code> [22]  :EndIf</code>
<code> [23]  :If 'win'≡⎕C A.GetOperatingSystem ⍬</code>
<code> [24]      {}A.GoToWebPage url</code>
<code> [25]  :Else</code>
<code class="emphasize">→[26]      ⎕←']Open ',url</code>
<code> [27]  :EndIf</code>
</div>
<code class="header" id="listing_8">#.APLGit2.APLGit2.CompareCommits_ &mdash; 48%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {noofBytes}←CompareCommits_(list branch1 branch2 folder currentBranch hash1 hash2 filename1 filename2)</code>
<code> [1]   noofBytes←0</code>
<code> [2]   :For thisFile :In list[;2]</code>
<code> [3]       extension←⎕C 3⊃⎕NPARTS thisFile</code>
<code> [4]       :If (⊂extension)∊'.aplf' '.aplo' '.apln' '.aplc' '.apli' '.dyalog' '.apla'</code>
<code> [5]           wsName←⎕SE.Link.GetItemName folder,'/',thisFile</code>
<code> [6]           header←↓U.Box(('⌹',[1]'⌹',,[0.5]wsName),[1]'⌹'),'⌹'</code>
<code> [7]           :If branch1≡currentBranch</code>
<code class="emphasize">→[8]           :AndIf 0&lt;nc←⎕NC wsName</code>
<code class="emphasize">→[9]               :If 9=nc</code>
<code class="emphasize">→[10]                  buff1←⎕SRC⍎wsName</code>
<code class="emphasize">→[11]              :ElseIf nc∊3 4</code>
<code class="emphasize">→[12]                  buff1←⎕NR wsName</code>
<code> [13]              :Else</code>
<code class="emphasize">→[14]                  :If ~(⎕DR buff1←⍎wsName)∊80 326</code>
<code class="emphasize">→[15]                      buff1←⎕SE.Dyalog.Array.Serialise wsName</code>
<code> [16]                  :EndIf</code>
<code> [17]              :EndIf</code>
<code> [18]          :Else</code>
<code> [19]              (rc more buff1)←folder U.RunGitCommand('show  --raw ',hash1,':',thisFile)</code>
<code> [20]              :If 0≠rc</code>
<code> [21]                  :If ∨/∨/¨'does not exist' 'exists on disk, but not' 'unknown revision or path not in the working tree'⍷¨⊂∊more</code>
<code> [22]                  :OrIf rc=128   ⍝ From experience we know that this often means that the file does not exist, though it might have other reasons...</code>
<code> [23]                      buff1←''</code>
<code> [24]                  :Else</code>
<code class="emphasize">→[25]                      ∘∘∘ ⍝ It appears that the file does not exist but we fail to analyze the error message correctly in this respect</code>
<code> [26]                  :EndIf</code>
<code> [27]              :EndIf</code>
<code> [28]          :EndIf</code>
<code> [29]          :If branch2≡currentBranch</code>
<code class="emphasize">→[30]          :AndIf 0&lt;nc←⎕NC wsName</code>
<code class="emphasize">→[31]              :If 9=nc</code>
<code class="emphasize">→[32]                  buff2←⎕SRC⍎wsName</code>
<code class="emphasize">→[33]              :ElseIf nc∊3 4</code>
<code class="emphasize">→[34]                  buff2←⎕NR wsName</code>
<code> [35]              :Else</code>
<code class="emphasize">→[36]                  :If ~(⎕DR buff2←⍎wsName)∊80 326</code>
<code class="emphasize">→[37]                      buff2←⎕SE.Dyalog.Array.Serialise wsName</code>
<code> [38]                  :EndIf</code>
<code> [39]              :EndIf</code>
<code> [40]          :Else</code>
<code> [41]              (rc more buff2)←folder U.RunGitCommand('show  --raw ',hash2,':',thisFile)</code>
<code> [42]              :If 0≠rc</code>
<code class="emphasize">→[43]                  :If ∨/∨/¨'does not exist' 'exists on disk, but not' 'unknown revision or path not in the working tree'⍷¨⊂∊more</code>
<code class="emphasize">→[44]                  :OrIf rc=128   ⍝ From experience we know that this often means that the file does not exist, though it might have other reasons...</code>
<code class="emphasize">→[45]                      buff2←''</code>
<code> [46]                  :Else</code>
<code class="emphasize">→[47]                      ∘∘∘ ⍝ It appears that the file does not exist but we fail to analyze the error message correctly in this respect</code>
<code> [48]                  :EndIf</code>
<code> [49]              :EndIf</code>
<code> [50]          :EndIf</code>
<code> [51]          buff1←header{⍺{⍺,⍵}⍣(0&lt;≢⍵)⊣⍵}buff1</code>
<code> [52]          buff2←header{⍺{⍺,⍵}⍣(0&lt;≢⍵)⊣⍵}buff2</code>
<code> [53]      :Else</code>
<code class="emphasize">→[54]          name←thisFile</code>
<code class="emphasize">→[55]          header←↓U.Box(('⌹',[1]'⌹',,[0.5]name),[1]'⌹'),'⌹'</code>
<code class="emphasize">→[56]          buff1←⊂'*** File ',((0&lt;≢extension)/'type '),'ignored: ',name{0=≢⍵:⍺ ⋄ ⍵}extension</code>
<code class="emphasize">→[57]          buff2←⊂'*** File ',((0&lt;≢extension)/'type '),'ignored: ',name{0=≢⍵:⍺ ⋄ ⍵}extension</code>
<code> [58]      :EndIf</code>
<code> [59]      :If buff1≢buff2</code>
<code> [60]          (⊂buff1)⎕NPUT filename1 2</code>
<code> [61]          (⊂buff2)⎕NPUT filename2 2</code>
<code> [62]          noofBytes+←⌈/{+/≢¨⍵}¨buff1 buff2</code>
<code> [63]      :EndIf</code>
<code> [64]  :EndFor</code>
<code> [65] ⍝Done</code>
</div>
<code class="header" id="listing_9">#.APLGit2.APLGit2.DiffBranches &mdash; 52%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{x}DiffBranches y</code>
<code> [1]  ⍝ Peforma `Diff` on (by default) the current branch and main</code>
<code> [2]   ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [3]   (space path)←EstablishProject y</code>
<code> [4]   :If 0=⎕NC'x'</code>
<code class="emphasize">→[5]   :OrIf 0=≢x</code>
<code> [6]       branches←(ListBranches path)~¨⊂' *'</code>
<code> [7]       'There is just one branch?!'U.Assert 1&lt;≢branches</code>
<code> [8]       currentBranch←CurrentBranch path</code>
<code> [9]       :If 1=≢branches~⊂currentBranch</code>
<code> [10]          branch1←currentBranch</code>
<code> [11]          branch2←⊃branches~⊂currentBranch</code>
<code> [12]      :Else</code>
<code class="emphasize">→[13]          'It''s not clear which branches you want to diff'U.Assert~(⊂currentBranch)∊'main' 'master'</code>
<code class="emphasize">→[14]          branch1←currentBranch</code>
<code class="emphasize">→[15]          branch2←⊃branches~⊂currentBranch</code>
<code> [16]      :EndIf</code>
<code> [17]  :Else</code>
<code class="emphasize">→[18]      x←⊆x</code>
<code class="emphasize">→[19]      'Optional left argument must have a length of 0, 1 or 2'U.Assert(≢x)∊1 2</code>
<code class="emphasize">→[20]      :If 1=≢⊆x</code>
<code class="emphasize">→[21]          branch1←1⊃,x</code>
<code class="emphasize">→[22]          branches←(ListBranches path)~¨⊂' *'</code>
<code class="emphasize">→[23]          branch2←⊃branches~⊂branch1</code>
<code> [24]      :Else</code>
<code class="emphasize">→[25]          (branch1 branch2)←x</code>
<code> [26]      :EndIf</code>
<code> [27]  :EndIf</code>
<code> [28]  (rc msg buff)←path U.RunGitCommand'diff ',branch1,'..',branch2</code>
<code> [29]  msg U.Assert 0=rc</code>
<code> [30]  r←buff</code>
<code> [31] ⍝Done</code>
</div>
<code class="header" id="listing_10">#.APLGit2.APLGit2.Squash &mdash; 62%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{x}Squash y</code>
<code> [1]  ⍝ Squashes some commits of the current branch into a single one.\\</code>
<code> [2]  ⍝ You can provide as a right argument:\\</code>
<code> [3]  ⍝  * A char vector; treated as commit message</code>
<code> [4]  ⍝  * An integer; treated as number of commits to be squashed</code>
<code> [5]  ⍝  * Any combination of message and number of commits in any sequence</code>
<code> [6]  ⍝  * An empty vector\\</code>
<code> [7]  ⍝ If the number of commits to be squashed was not defiend or is 0, a list of all candidates</code>
<code> [8]  ⍝ (commits) will be presented to you for selection.\\</code>
<code> [9]  ⍝ You may provide a meaningful message as the first right argument but if you don't you will be prompted.</code>
<code> [10] ⍝ If you still do not provide a meaningful message the function will throw an error.\\</code>
<code> [11] ⍝ In case of the current branch being "main" or "master" or any uncommited changes an error is thrown.\\</code>
<code> [12] ⍝ The number of commits to be squashed might be provided as (additional) right argument.</code>
<code> [13] ⍝ For what `⍺` can actually be see `EstablishProject`.\\</code>
<code> [14] ⍝ Returns the number of commits that were eventually squashed.\\</code>
<code> [15]  r←0</code>
<code> [16]  x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'x'</code>
<code> [17]  msg←'' ⋄ noOf←0</code>
<code> [18]  :If 0≠≢y</code>
<code> [19]      buff←2↑(⊆y),0</code>
<code> [20]      :If ' '=1↑0⍴1⊃buff</code>
<code> [21]          msg←1⊃buff</code>
<code> [22]          noOf←2⊃buff</code>
<code> [23]      :Else</code>
<code class="emphasize">→[24]          noOf←⊃y</code>
<code class="emphasize">→[25]          msg←{' '=1↑0⍴⍵:⍵ ⋄ ''}2⊃buff</code>
<code> [26]      :EndIf</code>
<code> [27]  :EndIf</code>
<code> [28]  (space folder)←EstablishProject x</code>
<code> [29]  currentBranch←CurrentBranch folder</code>
<code> [30]  'No squashing of main/master'U.Assert~(⊂currentBranch)∊'main' 'master'</code>
<code> [31]  'Cannot squash: there are uncommitted changes'U.Assert~IsDirty folder</code>
<code> [32]  :If 0=noOf</code>
<code> [33]      r←≢commits←folder RefLog 0</code>
<code> [34]  :Else</code>
<code> [35]      commits←folder RefLog 0</code>
<code> [36]      r←≢commits←(noOf⌊≢commits)↑commits</code>
<code> [37]  :EndIf</code>
<code> [38]  :If 0&lt;r</code>
<code> [39]      :If noOf&gt;0</code>
<code> [40]          noOf_←noOf</code>
<code> [41]      :Else</code>
<code> [42]          noOf_←U.GetNumberOfCommits commits currentBranch folder'How many commits would you like to squash? (empty=quit) '</code>
<code> [43]      :EndIf</code>
<code> [44]  :EndIf</code>
<code> [45]  :If 0&lt;noOf_</code>
<code> [46]      :If 0=≢msg</code>
<code class="emphasize">→[47]          ⍞←'Provide a meaningful commit message in the editor:'</code>
<code class="emphasize">→[48]          ⎕SE.⎕SHADOW'TEMP'</code>
<code class="emphasize">→[49]          'TEMP'⎕SE.⎕NS''</code>
<code class="emphasize">→[50]          :If 0=≢⎕SE.TEMP.CommitMsg←{0=≢⍵:⍵ ⋄ ⊃{⍺,(⎕UCS 13),⍵}/⍵}{⍵/⍨0&lt;≢¨⍵~¨⊂' .'}commits[⍳noOf_;4]</code>
<code class="emphasize">→[51]              historyPath←(({⍵,'.',(⍵⍳'.')↓⍵}space)),'.History'</code>
<code class="emphasize">→[52]              :If 0&lt;⎕NC historyPath</code>
<code class="emphasize">→[53]                  ⎕SE.TEMP.CommitMsg←{1↓⍵↑⍨1++/∧\'*'≠1↓⊃¨⍵}⍎historyPath</code>
<code class="emphasize">→[54]              :ElseIf 0&lt;|⎕NC⊂historyPath</code>
<code class="emphasize">→[55]                  :Trap 0</code>
<code> [56]                      ⍝ Assumes something like "* Foo 1.2.3 from xx.xx.xxx" with an indented sub list:</code>
<code class="emphasize">→[57]                      ⎕SE.TEMP.CommitMsg←{(1↓⍵)↑⍨+/∧\' '=1↓,1↑[2]⍵}2↓[2]A.DLB 2↓180⌶historyPath</code>
<code class="emphasize">→[58]                      ⎕SE.TEMP.CommitMsg←,{⍵↓[2]⍨⌊/+/∧\' '=⍵}⎕SE.TEMP.CommitMsg</code>
<code> [59]                  :EndTrap</code>
<code> [60]              :EndIf</code>
<code> [61]          :EndIf</code>
<code class="emphasize">→[62]          ⎕SE.TEMP.⎕ED'CommitMsg'</code>
<code class="emphasize">→[63]          msg←⎕SE.TEMP.CommitMsg</code>
<code class="emphasize">→[64]          :If 2=≡msg</code>
<code class="emphasize">→[65]              msg←1↓⊃,/';',¨msg</code>
<code> [66]          :Else</code>
<code class="emphasize">→[67]              msg←(~(⎕UCS 13 13)⍷msg)/msg</code>
<code class="emphasize">→[68]              msg←(-(⎕UCS 13)=¯1↑msg)↓msg</code>
<code> [69]          :EndIf</code>
<code> [70]      :EndIf</code>
<code> [71]      'Sqash requires a meaningful message'U.Assert 0&lt;≢msg~' .'</code>
<code> [72]      (rc more buff)←folder U.RunGitCommand('reset --soft HEAD~',⍕noOf_)</code>
<code> [73]      ('Reset failed; RC=',(⍕rc),' ',more)U.Assert 0=rc</code>
<code> [74]      buff U.Assert 0=≢buff</code>
<code> [75]      msg←U.MassageMsg msg</code>
<code> [76]      msg←'-m "',msg,'"'</code>
<code> [77]      (rc more buff)←folder U.RunGitCommand('commit ',msg)</code>
<code> [78]      ('Committing after resetting failed; RC=',(⍕rc),' ',more)U.Assert 0=rc</code>
<code> [79]      r←noOf_</code>
<code> [80]  :EndIf</code>
<code> [81] ⍝Done</code>
</div>
<code class="header" id="listing_11">#.APLGit2.APLGit2.SetDefaultProject &mdash; 63%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{force}SetDefaultProject y</code>
<code> [1]  ⍝ `y` may be either the name of a namespace or a folder.\\</code>
<code> [2]  ⍝ That defines an opened Cider project; if it does not an error is thrown.\\</code>
<code> [3]  ⍝  * In case `y` is '?' the user is presented a list of opened Cider projects to select from</code>
<code> [4]  ⍝  * In case `y` is empty DEFAULT_PROJECT←'' is executed</code>
<code> [5]  ⍝ `force` is useful for test cases in order to avoid interaction with a user.\\</code>
<code> [6]  ⍝ Returns (space folder) for the selected project or '' if there isn't one set.</code>
<code> [7]   force←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'force'</code>
<code> [8]   list←⎕SE.Cider.ListOpenProjects 0</code>
<code> [9]   r←''</code>
<code> [10]  DEFAULT_PROJECT←{0&lt;⎕NC ⍵:DEFAULT_PROJECT ⋄ ''}'DEFAULT_PROJECT'    ⍝ Initalise the default project as undefined</code>
<code> [11]  :If 0=≢y←⍕y</code>
<code> [12]      :If 0&lt;≢DEFAULT_PROJECT</code>
<code> [13]          :If force</code>
<code class="emphasize">→[14]          :OrIf 1 CommTools.YesOrNo'Undefine default project (Is currently ',(⊃{0=≢⍺:⍵ ⋄ ⍺,' [',⍵,']'}/DEFAULT_PROJECT),') '</code>
<code> [15]              r←DEFAULT_PROJECT←''</code>
<code> [16]          :Else</code>
<code class="emphasize">→[17]              r←DEFAULT_PROJECT,' remaines to be the default project'</code>
<code> [18]          :EndIf</code>
<code> [19]      :EndIf</code>
<code> [20]  :ElseIf (,'?')≡,y~'[]'</code>
<code class="emphasize">→[21]      DEFAULT_PROJECT_was←DEFAULT_PROJECT</code>
<code class="emphasize">→[22]      DEFAULT_PROJECT←''</code>
<code class="emphasize">→[23]      :If 0=≢r←DEFAULT_PROJECT←EstablishProject''</code>
<code class="emphasize">→[24]          r←DEFAULT_PROJECT←DEFAULT_PROJECT_was                      ⍝ User did cancel, so we restore the original setting</code>
<code> [25]      :EndIf</code>
<code> [26]  :Else</code>
<code> [27]      :If ∨/'/\:'∊y</code>
<code class="emphasize">→[28]          folder←F.EnforceSlash y</code>
<code class="emphasize">→[29]          row←(F.EnforceSlash¨list[;2])⍳⊂folder</code>
<code> [30]      :Else</code>
<code> [31]          '⍵ is not a namespace'U.Assert 9=⎕NC y</code>
<code> [32]          row←list[;1]⍳⊂y</code>
<code> [33]      :EndIf</code>
<code> [34]      :If row≤≢list</code>
<code> [35]          (space folder)←list[row;]</code>
<code> [36]      :Else</code>
<code class="emphasize">→[37]          space←''</code>
<code> [38]      :EndIf</code>
<code> [39]      r←DEFAULT_PROJECT←space folder</code>
<code> [40]  :EndIf</code>
<code> [41] ⍝Done</code>
</div>
<code class="header" id="listing_12">#.APLGit2.APLGit2.LatestRelease &mdash; 69%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{verbose}LatestRelease(username repoName)</code>
<code> [1]   ⍝ Returns the tag of the latest release.</code>
<code> [2]   ⍝ By default any draft releases are ignored.</code>
<code> [3]   ⍝ "username" is expected to be the GitHub username. It's the equivalent of "group" in Tatin.</code>
<code> [4]   'This function is "Windows only"'U.Assert'win'≡⎕C A.GetOperatingSystem ⍬</code>
<code> [5]   verbose←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'verbose'</code>
<code> [6]   'Both "username" and "repoName" must not be empty'U.Assert 0∧.&lt;≢¨username repoName</code>
<code> [7]   GH←⎕NEW GitHubAPIv3(,⊂username)</code>
<code> [8]   :Trap 0</code>
<code> [9]       (rc msg data)←GH.GetLatestReleaseInfo repoName</code>
<code> [10]  :Else</code>
<code class="emphasize">→[11]      qdmx←⎕DMX</code>
<code class="emphasize">→[12]      U.ErrNo ⎕SIGNAL⍨qdmx.EM</code>
<code> [13]  :EndTrap</code>
<code> [14]  :If 90=rc</code>
<code class="emphasize">→[15]      msg U.Assert rc≠90</code>
<code> [16]  :Else</code>
<code> [17]      :If verbose</code>
<code class="emphasize">→[18]          r←data.(tag_name published_at name)</code>
<code> [19]      :Else</code>
<code> [20]          r←data.tag_name</code>
<code> [21]      :EndIf</code>
<code> [22]  :EndIf</code>
<code> [23] ⍝Done</code>
</div>
<code class="header" id="listing_13">#.APLGit2.APLGit2.GetTagOfLatestRelease &mdash; 71%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{verbose}GetTagOfLatestRelease(username repoName)</code>
<code> [1]   ⍝ Returns the tag of the latest release.</code>
<code> [2]   ⍝ By default any draft releases are ignored.</code>
<code> [3]   ⍝ "username" is expected to be the GitHub username. It's the equivalent of "group" in Tatin.</code>
<code> [4]   verbose←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'verbose'</code>
<code> [5]   'Both "username" and "repoName" must not be empty'U.Assert 0∧.&lt;≢¨username repoName</code>
<code> [6]   GH←⎕NEW GitHubAPIv3(,⊂username)</code>
<code> [7]   :Trap 0</code>
<code> [8]       (rc msg data)←GH.GetLatestReleaseInfo repoName</code>
<code> [9]   :Else</code>
<code class="emphasize">→[10]      qdmx←⎕DMX</code>
<code class="emphasize">→[11]      U.ErrNo ⎕SIGNAL⍨qdmx.EM</code>
<code> [12]  :EndTrap</code>
<code> [13]  :If 90=rc</code>
<code> [14]      :If ∨/'(404)'⍷∊msg</code>
<code> [15]          U.ErrNo ⎕SIGNAL⍨'Repo &lt;',repoName,'&gt; not found (404)'</code>
<code> [16]      :Else</code>
<code class="emphasize">→[17]          msg U.Assert rc≠90</code>
<code> [18]      :EndIf</code>
<code> [19]  :Else</code>
<code> [20]      :If verbose</code>
<code> [21]          r←data.(tag_name published_at name)</code>
<code> [22]      :Else</code>
<code class="emphasize">→[23]          r←data.tag_name</code>
<code> [24]      :EndIf</code>
<code> [25]  :EndIf</code>
<code> [26] ⍝Done</code>
</div>
<code class="header" id="listing_14">#.APLGit2.APLGit2.EstablishProject &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  (namespace folder)←{noSelect}EstablishProject y</code>
<code> [1]  ⍝ If `y` is empty:</code>
<code> [2]  ⍝  * In case of a single open Cider project its project path is taken.</code>
<code> [3]  ⍝  * If there are several Cider projects open then the user will be asked whether she wants to act on DEFAULT_PROJECT</code>
<code> [4]  ⍝    if that points to an open Cider project. If she refuses she will be prompted for the correct one.\\</code>
<code> [5]  ⍝ Otherwise `y` must be the name of an opened Cider project or a path to a project.\\</code>
<code> [6]  ⍝ Note that projects defined this way cannot become the default project. See ]APLGit2.SetDefaultProject for that.\\</code>
<code> [7]  ⍝ Returns a two-column matrix with namespace name and folder, or both empty.\\</code>
<code> [8]  ⍝ In case a path is specified it does not have to be an opened Cider project. However, this will effect only a few</code>
<code> [9]  ⍝ commands (like `IsDirty`, `OpenGitShell` and `Init`) since most commands are bound to be executed on a Cider project.\\</code>
<code> [10] ⍝ `noSelect` defaults to 0, meaning that the user will be presented a list of opened Cider projects ind case no</code>
<code> [11] ⍝ project can be established by other means. To supress this specify a 1 as ⍺.</code>
<code> [12]  noSelect←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'noSelect'</code>
<code> [13]  y←⍕y</code>
<code> [14]  (namespace folder)←'' ''</code>
<code> [15]  list←⎕SE.Cider.ListOpenProjects 0</code>
<code> [16]  DEFAULT_PROJECT←{0&lt;⎕NC ⍵:DEFAULT_PROJECT ⋄ ''}'DEFAULT_PROJECT'    ⍝ Initalise the default project as undefined</code>
<code> [17]  :If 0=≢y</code>
<code> [18]      :If 0=≢list</code>
<code class="emphasize">→[19]          :Return</code>
<code> [20]      :ElseIf 0&lt;≢DEFAULT_PROJECT</code>
<code class="emphasize">→[21]          (namespace folder)←DEFAULT_PROJECT</code>
<code> [22]      :ElseIf 1=≢list</code>
<code class="emphasize">→[23]          (namespace folder)←list[1;]</code>
<code class="emphasize">→[24]          :If (⊂DEFAULT_PROJECT)∊↓list                               ⍝ Only if it's an opened Cider project</code>
<code class="emphasize">→[25]              (namespace folder)←DEFAULT_PROJECT</code>
<code class="emphasize">→[26]              :Return</code>
<code> [27]          :Else</code>
<code class="emphasize">→[28]              DEFAULT_PROJECT←''</code>
<code> [29]          :EndIf</code>
<code> [30]      :ElseIf ~noSelect</code>
<code> [31]          (namespace folder)←U.SelectProject list</code>
<code> [32]      :EndIf</code>
<code> [33]  :Else</code>
<code> [34]      :If ∨/'/\:'∊y</code>
<code> [35]          folder←y</code>
<code> [36]          :If 1=+/bool←(F.EnforceSlash¨list[;2])≡¨⊂F.EnforceSlash folder</code>
<code> [37]              namespace←⊃list[bool⍳1;]</code>
<code> [38]          :EndIf</code>
<code> [39]      :Else</code>
<code> [40]          'Is not a namespace'U.Assert(⊃y)∊'#⎕'</code>
<code> [41]          'There are no open Cider projects'U.Assert 0&lt;≢list</code>
<code> [42]          bool←list[;1]≡¨⊂y</code>
<code> [43]          'Is not an opened Cider project'U.Assert 1=+/bool</code>
<code> [44]          (namespace folder)←list[bool⍳1;]</code>
<code> [45]      :EndIf</code>
<code> [46]      'Folder does not exist'U.Assert ⎕NEXISTS folder</code>
<code> [47]  :EndIf</code>
<code> [48] ⍝Done</code>
</div>
<code class="header" id="listing_15">#.APLGit2.APLGit2.GetDefaultProject &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetDefaultProject dummy</code>
<code> [1] ⍝ Reports the current setting of Git's default project or '' if there isn't one.</code>
<code> [2]  DEFAULT_PROJECT←{0&lt;⎕NC ⍵:DEFAULT_PROJECT ⋄ ''}'DEFAULT_PROJECT'    ⍝ Initalise the default project as undefined</code>
<code> [3]  r←''</code>
<code> [4]  :If 0&lt;≢DEFAULT_PROJECT</code>
<code class="emphasize">→[5]      r←DEFAULT_PROJECT</code>
<code> [6]  :EndIf</code>
<code> [7] ⍝Done</code>
</div>
<code class="header" id="listing_16">#.APLGit2.APLGit2.CompareCommits &mdash; 79%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  (filename1 filename2)←{x}CompareCommits y</code>
<code> [1]  ⍝ Allows inspection of all differences between two commits in a single comparison.\\</code>
<code> [2]  ⍝ In case `⍵` is empty the last commit is compared with the checkout commit of the current branch.</code>
<code> [3]  ⍝ In case `⍵` is a single commit it is compared with the last commit.</code>
<code> [4]  ⍝ Instead one can specify two commits (hashes) explicitly via the right argument.</code>
<code> [5]  ⍝ For what `x` can actually be see `EstablishProject`.\\</code>
<code> [6]  ⍝ Returns either two empty vectors in case no differences were detected or two filenames otherwise.\\</code>
<code> [7]  ⍝ If the user command `CompareFiles` and one of its comparison utilities is available the two files are compared straight away.\\</code>
<code> [8]  ⍝ Note that this tool focusses on APL source files, all other files are ingored.</code>
<code> [9]  ⍝ If a Cider config file is found in "folder" then "CIDER.source" is honored.</code>
<code> [10]  x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'x'</code>
<code> [11]  (space folder)←EstablishProject x</code>
<code> [12]  filename1←filename2←''</code>
<code> [13]  :If 0&lt;≢space,folder</code>
<code> [14]      branch←CurrentBranch folder</code>
<code> [15]      y←{0=≢⍵:⍵ ⋄ ⊆⍵}y</code>
<code> [16]      :If 0=≢y</code>
<code> [17]      :OrIf 0=+/≢¨y</code>
<code class="emphasize">→[18]          hash1←GetLastCommit folder</code>
<code class="emphasize">→[19]          hash2←GetMostRecentAncestor folder</code>
<code> [20]      :ElseIf 1=≢y</code>
<code> [21]      :OrIf 1=+/0=≢¨y</code>
<code class="emphasize">→[22]          hash1←GetLastCommit folder</code>
<code class="emphasize">→[23]          hash2←1⊃,y</code>
<code> [24]      :Else</code>
<code> [25]          (hash1 hash2)←y~''⍬ 0</code>
<code> [26]      :EndIf</code>
<code> [27]      'The two hashes match - that makes no sense'U.Assert hash1≢hash2</code>
<code> [28]      :If 0&lt;≢list←folder DiffBetween hash1 hash2</code>
<code> [29]          :If F.IsFile folder,'/cider.config'</code>
<code> [30]              cfg←⊃F.NGET folder,'/cider.config'</code>
<code> [31]              ns←⎕JSON⍠('Dialect' 'JSON5')⊣cfg</code>
<code> [32]          :AndIf F.IsDir folder,'/',ns.CIDER.source</code>
<code> [33]              list←((F.EnforceSlash{⍵,'/'/⍨~'/\'∊⍨¯1↑⍵}ns.CIDER.source){⍺∘≡¨(≢⍺)↑¨⍵}⊢/list)⌿list</code>
<code> [34]          :EndIf</code>
<code> [35]      :AndIf 0&lt;≢list←('.aplc' '.aplf' '.apln' '.aplo' '.apli' '.dyalog'∊⍨{3⊃⎕NPARTS ⍵}¨⊢/list)⌿list</code>
<code> [36]          (filename1 filename2)←'txt'∘F.GetTempFilename2¨2⍴⊂''</code>
<code> [37]          noofBytes←CompareCommits_ list(branch,': ',hash1)(branch,': ',hash2)folder branch hash1 hash2 filename1 filename2</code>
<code> [38]          :If 0=noofBytes</code>
<code class="emphasize">→[39]              ⎕NDELETE filename1 filename2</code>
<code class="emphasize">→[40]              filename1←filename2←''</code>
<code> [41]          :EndIf</code>
<code> [42]      :EndIf</code>
<code> [43]  :EndIf</code>
<code> [44] ⍝Done</code>
</div>
<code class="header" id="listing_17">#.APLGit2.APLGit2.GetPathFromProject &mdash; 80%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetPathFromProject space</code>
<code> [1]  ⍝ Takes the name (top container) of an opened Cider project and returns its path name.</code>
<code> [2]   list←⎕SE.Cider.ListOpenProjects 0</code>
<code> [3]   row←(list[;1])⍳⊂space</code>
<code> [4]   :If row≤≢list</code>
<code> [5]       r←2⊃list[row;]</code>
<code> [6]   :Else</code>
<code class="emphasize">→[7]       r←''</code>
<code> [8]   :EndIf</code>
<code> [9]  ⍝Done</code>
</div>
<code class="header" id="listing_18">#.APLGit2.APLGit2.GetProjectFromPath &mdash; 80%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetProjectFromPath path</code>
<code> [1]  ⍝ Takes the path of an opened Cider project and returns its name.\\</code>
<code> [2]  ⍝ If path does not point to an opened Cider project then r is empty.</code>
<code> [3]   list←⎕SE.Cider.ListOpenProjects 0</code>
<code> [4]   row←(F.NormalizePath U.AddSlash¨list[;2])⍳⊂F.NormalizePath U.AddSlash path</code>
<code> [5]   :If row≤≢list</code>
<code> [6]       r←1⊃list[row;]</code>
<code> [7]   :Else</code>
<code class="emphasize">→[8]       r←''</code>
<code> [9]   :EndIf</code>
<code> [10] ⍝Done</code>
</div>
<code class="header" id="listing_19">#.APLGit2.APLGit2.U.RunGitCommand &mdash; 83%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  (rc msg result)←path RunGitCommand command</code>
<code> [1]   path←{'/'@(⍸'/'=⍵)⊣⍵}path</code>
<code> [2]   cmd←'-C "',path,'" ',command</code>
<code> [3]   buff←RunProcess'git'cmd</code>
<code> [4]   (rc msg result)←buff.(ExitCode StdErr StdOut)</code>
<code> [5]   :Select rc</code>
<code> [6]   :Case 127</code>
<code class="emphasize">→[7]       msg←'It appears that Git is not installed'</code>
<code> [8]   :Case 128</code>
<code> [9]       :If ∨/'Who are you'⍷msg</code>
<code class="emphasize">→[10]          msg←'Who are you? (set user.email and user.name)'</code>
<code> [11]      :EndIf</code>
<code> [12]  :Else</code>
<code> [13]      :If 0=≢msg</code>
<code> [14]          msg←command,' =&gt; ',path</code>
<code> [15]      :EndIf</code>
<code> [16]  :EndSelect</code>
<code> [17] ⍝Done</code>
</div>
<code class="header" id="listing_20">#.APLGit2.APLGit2.AddGitAttributes &mdash; 87%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{quiet}AddGitAttributes path</code>
<code> [1]   r←⍬</code>
<code> [2]   quiet←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'quiet'</code>
<code> [3]   :If quiet</code>
<code class="emphasize">→[4]   :OrIf CommTools.YesOrNo'Add .gitattributes for APLers to ',path,' ?'</code>
<code> [5]       buff←''</code>
<code> [6]       buff,←⊂'# Auto detect text files (for EOL-auto conversion)'</code>
<code> [7]       buff,←⊂'* text=auto'</code>
<code> [8]       buff,←⊂''</code>
<code> [9]       buff,←⊂'*.apl? linguist-language=apl'</code>
<code> [10]      buff,←⊂'*.dyapp linguist-language=apl'</code>
<code> [11]      buff,←⊂'*.dyalog linguist-language=apl'</code>
<code> [12]      buff,←⊂'*.dws linguist-language=apl'</code>
<code> [13]      (⊂buff)⎕NPUT path,'/.gitattributes'</code>
<code> [14]      :If ~quiet</code>
<code class="emphasize">→[15]          ⎕←'.gitattributes created in ',path,' but check content!'</code>
<code> [16]      :EndIf</code>
<code> [17]  :EndIf</code>
</div>
<code class="header" id="listing_21">#.APLGit2.APLGit2.DiffBetween &mdash; 88%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{x}DiffBetween y</code>
<code> [1]  ⍝ Lists all file differences between `y`.\\</code>
<code> [2]  ⍝ * In case `y` is empty it defaults to "master" and "dev".</code>
<code> [3]  ⍝ * If it is not empty it must be a two-element vector.\\</code>
<code> [4]  ⍝   The two items can each specify a branch but also a commit-hash.\\</code>
<code> [5]  ⍝ For what `x` can actually be see `EstablishProject`.\\</code>
<code> [6]   x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'x'</code>
<code> [7]   (space folder)←EstablishProject x</code>
<code> [8]   :If 0=≢y</code>
<code class="emphasize">→[9]       (d1 d2)←'main' 'dev'</code>
<code> [10]  :Else</code>
<code> [11]      (d1 d2)←y</code>
<code> [12]  :EndIf</code>
<code> [13]  (rc more buff)←folder U.RunGitCommand('diff --name-status ',d1,'..',d2)</code>
<code> [14]  more U.Assert 0=rc</code>
<code> [15]  r←↑{i←⍵⍳' ' ⋄ ((i-1)↑⍵)(A.DLB i↓⍵)}¨buff</code>
<code> [16] ⍝Done</code>
</div>
<code class="header" id="listing_22">#.APLGit2.APLGit2.U.GetNumberOfCommits &mdash; 90%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  no←GetNumberOfCommits(commits branch folder caption)</code>
<code> [1]   no←flag←0</code>
<code> [2]   :Repeat</code>
<code> [3]       width←⎕PW</code>
<code> [4]       ⎕←width↑('--- Commits in branch "',branch,'" of project "',folder,'"'),' ',⎕PW⍴'-'</code>
<code> [5]       buff←(↑commits[;1]),' ',(↑commits[;2]),' ',(↑commits[;3]),' ',↑commits[;4]</code>
<code> [6]       buff←A.DTB⍕¨(((0,⍨≢⍕≢buff)∘⍕¨⍳≢buff),¨⊂'. '),¨↓buff</code>
<code> [7]       buff←↑(width-1){⍺&gt;≢⍵:⍵ ⋄ ((⍺-3)↑⍵),'...'}¨buff</code>
<code> [8]       ⍞←buff</code>
<code> [9]       ⎕←''</code>
<code> [10]      val←⍞,0/⍞←caption</code>
<code> [11]      val←(≢caption)↓val</code>
<code> [12]      {⍵:.}val≡'∘∘∘'</code>
<code> [13]      :If 0=≢val</code>
<code class="emphasize">→[14]          flag←1</code>
<code> [15]      :ElseIf ∨/b←⊃⎕VFI val</code>
<code> [16]      :AndIf 1=≢b</code>
<code> [17]          no←2⊃⎕VFI val</code>
<code> [18]          :If no∊0,⍳≢commits</code>
<code> [19]              flag←1</code>
<code> [20]          :Else</code>
<code class="emphasize">→[21]              0 0⍴⍞,⍞←'Please enter a number between 1 and ',(⍕≢commits),' or nothing to quit; press &lt;enter&gt; to continue'</code>
<code> [22]          :EndIf</code>
<code> [23]      :EndIf</code>
<code> [24]  :Until flag</code>
</div>
<code class="header" id="listing_23">#.APLGit2.APLGit2.Log &mdash; 91%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{parms_}Log y</code>
<code> [1]  ⍝ Returns the log of commits.\\</code>
<code> [2]  ⍝ The result depends on `verbose`.</code>
<code> [3]  ⍝ * If it's 0 (the default) then r is a nested matrix with four columns:\\</code>
<code> [4]  ⍝    1. Hash of the commit</code>
<code> [5]  ⍝    2. Committer</code>
<code> [6]  ⍝    3. Commit date</code>
<code> [7]  ⍝    4. Commit message; multi-line messages are compressed</code>
<code> [8]  ⍝ * It it's 1 r is a simple character matrix</code>
<code> [9]  ⍝ With the optional `since` you can limit the result by date.\\</code>
<code> [10] ⍝ For the date two formats are supported:</code>
<code> [11] ⍝  * 'YYY-MM-DD' as text</code>
<code> [12] ⍝  * yyyymmdd as an integer\\</code>
<code> [13] ⍝ `y` must be one of:</code>
<code> [14] ⍝   * Fully qualified name of a namespace  that is an opened Cider project</code>
<code> [15] ⍝   * Fully qualified path to a Git-managed project</code>
<code> [16]  ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [17]  r←''</code>
<code> [18]  (space folder)←EstablishProject y</code>
<code> [19]  parms←⎕NS''</code>
<code> [20]  parms.since←''</code>
<code> [21]  parms.verbose←0</code>
<code> [22]  parms.branch←''</code>
<code> [23]  parms.max←¯1</code>
<code> [24]  :If 9=⎕NC'parms_'</code>
<code> [25]      'parms'⎕NS parms_</code>
<code> [26]  :EndIf</code>
<code> [27]  :If 0&lt;parms.⎕NC'since'</code>
<code> [28]  :AndIf 0=1↑0⍴parms.since</code>
<code class="emphasize">→[29]      parms.since←{(4↑⍵),'-',(2↑4↓⍵),'-',(2↑6↓⍵)}⍕⌊parms.since</code>
<code> [30]  :EndIf</code>
<code> [31]  :If ~∧/(parms.⎕NL-2)∊list←'since' 'verbose' 'branch' 'max'</code>
<code class="emphasize">→[32]      811 ⎕SIGNAL⍨'Invalid parameters: ',⊃{⍺,',',⍵}/(parms.⎕NL-2)~list</code>
<code> [33]  :EndIf</code>
<code> [34]  cmd←'log '</code>
<code> [35]  :If 0&lt;≢parms.branch</code>
<code> [36]      cmd,←parms.branch,' '</code>
<code> [37]      unwantedBranches←((⊂' *')~⍨¨ListBranches folder)~⊂parms.branch</code>
<code> [38]      cmd,←⊃,/{'--not ',⍵,' '}¨unwantedBranches</code>
<code> [39]  :EndIf</code>
<code> [40]  :If ¯1≢parms.max</code>
<code> [41]      cmd,←' -n ',(⍕parms.max),' '</code>
<code> [42]  :EndIf</code>
<code> [43]  cmd,←(0&lt;≢parms.since)/'--since=',(⍕parms.since),' '</code>
<code> [44]  :If 0=parms.verbose</code>
<code> [45]      cmd,←'--pretty=format:"',U.GetLogFormat,'" '</code>
<code> [46]  :EndIf</code>
<code> [47]  cmd,←'--date=',U.GetDateFormat</code>
<code> [48]  (rc msg buff)←folder U.RunGitCommand cmd</code>
<code> [49]  msg U.Assert 0=rc</code>
<code> [50]  :If parms.verbose</code>
<code class="emphasize">→[51]      r←⍕⍪buff</code>
<code> [52]  :Else</code>
<code> [53]      :If 0=≢buff</code>
<code> [54]          r←0 4⍴''</code>
<code> [55]      :Else</code>
<code> [56]          r←U.FormatLog buff</code>
<code> [57]      :EndIf</code>
<code> [58]  :EndIf</code>
<code> [59] ⍝Done</code>
</div>
<code class="header" id="listing_24">#.APLGit2.APLGit2.Commit &mdash; 93%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{msg}Commit y</code>
<code> [1]  ⍝ Commit changes.\\</code>
<code> [2]  ⍝ If the current branch is "main" (or "master") then `msg` **_must not_** be empty and should carry a meaningful message.</code>
<code> [3]  ⍝ Otherwise `msg` may be empty but will become three dots (`...`).\\</code>
<code> [4]  ⍝ `y` must be one of:</code>
<code> [5]  ⍝   * Fully qualfied name of a namespace that is an opened Cider project</code>
<code> [6]  ⍝   * Fully qualified path to a Git-managed project</code>
<code> [7]  ⍝ Returns a two-element vector:</code>
<code> [8]  ⍝  1. The name of the branch</code>
<code> [9]  ⍝  2. The hash of the commit as a simple text string</code>
<code> [10]  ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [11]  msg←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'msg'</code>
<code> [12]  msg←{0=≢⍵:'...' ⋄ ⍵}msg</code>
<code> [13]  (space path)←EstablishProject y</code>
<code> [14]  cb←CurrentBranch path</code>
<code> [15]  nm←~(⊂cb)∊'master' 'main'</code>
<code> [16]  ('You must provide a meaningful message in the "',cb,'" branch')⎕SIGNAL 11/⍨(0=nm)∧0=≢msg</code>
<code> [17]  msg_←U.MassageMsg msg</code>
<code> [18]  cmd←'commit -m "',msg_,'"'</code>
<code> [19]  (rc msg buff)←path U.RunGitCommand cmd</code>
<code> [20]  :If ∨/'nothing to commit, working tree clean'⍷∊buff</code>
<code class="emphasize">→[21]      r←buff</code>
<code> [22]  :Else</code>
<code> [23]      msg U.Assert 0=rc</code>
<code> [24]      r←buff</code>
<code> [25]  :EndIf</code>
<code> [26] ⍝Done</code>
</div>
<code class="header" id="listing_25">#.APLGit2.APLGit2.OpenGitShell &mdash; 94%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←OpenGitShell y</code>
<code> [1]  ⍝ Opens a Terminal in `y`.\\</code>
<code> [2]  ⍝ `y` must be one of:\\</code>
<code> [3]  ⍝   * Fully qualified path to a Git-managed project</code>
<code> [4]  ⍝   * Fully qualified name of a namespace that is an opened Cider project\\</code>
<code> [5]  ⍝ Returns always 0\\</code>
<code> [6]  ⍝ This has been tested on Windows, Mac-OS and Ubuntu.</code>
<code> [7]   r←0</code>
<code> [8]   (space path)←EstablishProject y</code>
<code> [9]   :Select ⎕C A.GetOperatingSystem ⍬</code>
<code> [10]  :Case 'win'</code>
<code> [11]      paths←';'A.Split 2 ⎕NQ #'GetEnvironment' 'PATH'</code>
<code> [12]      :If 1=+/bool←∨/¨'\git\bin'∘⍷¨⎕C paths</code>
<code> [13]          home←(bool⍳1)⊃paths</code>
<code> [14]          pathToGitExe←home,'\sh.exe'</code>
<code> [15]      :Else</code>
<code class="emphasize">→[16]          'GitBash not found!'⎕SIGNAL 6</code>
<code> [17]      :EndIf</code>
<code> [18]      cmd←('"',pathToGitExe,'" --cd="',path,'"')</code>
<code> [19]      ⎕SH cmd''</code>
<code> [20]  :Case 'lin'</code>
<code> [21]      cmd←'gnome-terminal -- $SHELL -c "cd ',path,';git status; exec $SHELL"'</code>
<code> [22]      ⎕SH cmd</code>
<code> [23]  :Case 'mac'</code>
<code> [24]      cmd←'osascript -e ''tell app "terminal" to do script "cd ',path,';git status "'''</code>
<code> [25]      ⎕SH cmd</code>
<code> [26]  :EndSelect</code>
<code> [27] ⍝Done</code>
</div>
<code class="header" id="listing_26">#.APLGit2.APLGit2.ChangeLog &mdash; 96%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{x}ChangeLog name</code>
<code> [1]  ⍝ Takes the name of an APL object or a filenamem and returns a matrix with information about all commits that object was changed by.\\</code>
<code> [2]  ⍝ The result is a matrix with zero or more rows and 4 columns:</code>
<code> [3]  ⍝ 1. Hash</code>
<code> [4]  ⍝ 2. Commiter's name</code>
<code> [5]  ⍝ 3. Date of the commit date in strict ISO 8601 format</code>
<code> [6]  ⍝ 4. Message of the commit\\</code>
<code> [7]  ⍝ For what `x` can actually be see `EstablishProject`.\\</code>
<code> [8]   r←0 4⍴''</code>
<code> [9]   :If ∨/'/\:'∊name</code>
<code> [10]      filename←F.EnforceSlash name</code>
<code> [11]      :If ':'∊filename</code>
<code> [12]      :OrIf '/'=⊃filename</code>
<code> [13]          allProjects←(⎕SE.Cider.ListOpenProjects 0)[;2],¨'/'</code>
<code> [14]          path←⊃⎕NPARTS filename</code>
<code> [15]          'No fitting project found'U.Assert∨/bool←allProjects∊(≢¨allProjects)↑¨⊂filename</code>
<code> [16]          path←(bool⍳1)⊃allProjects</code>
<code> [17]      :EndIf</code>
<code> [18]  :Else</code>
<code> [19]      x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'x'</code>
<code> [20]      project←EstablishProject x</code>
<code> [21]      'Not a Cider project'⎕SIGNAL 11/⍨0=≢project</code>
<code> [22]      (space path)←2↑project</code>
<code> [23]      :If ~(⊃name)∊'#⎕'</code>
<code> [24]          name←space,'.',name</code>
<code> [25]      :EndIf</code>
<code> [26]      filename←(1+≢path)↓⎕SE.Link.GetFileName name</code>
<code> [27]      ('APL  object not found: ',name)⎕SIGNAL 6/⍨0=≢filename</code>
<code> [28]  :EndIf</code>
<code> [29]  cmd←'log --follow --pretty=format:"',U.GetLogFormat,'" -- ',filename</code>
<code> [30]  (rc msg buff)←path U.RunGitCommand cmd</code>
<code> [31]  :If 1=≢'fatal: your current branch ''[^'']+'' does not have any commits yet'⎕S 0⊣∊msg</code>
<code class="emphasize">→[32]      r←''</code>
<code> [33]  :Else</code>
<code> [34]      (∊msg)U.Assert 0=rc</code>
<code> [35]      :If 0&lt;≢buff</code>
<code> [36]          r←↑U.FormatLog buff</code>
<code> [37]      :EndIf</code>
<code> [38]  :EndIf</code>
<code> [39] ⍝Done</code>
</div>
<code class="header" id="listing_27">#.APLGit2.APLGit2.AddGitIgnore &mdash; 97%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{quiet}AddGitIgnore y</code>
<code> [1]  ⍝ Add a .gitignore file to a project, oe merge default values into an existing one.</code>
<code> [2]  ⍝ The user is questioned several times, and she may edit the result before it is written to file.</code>
<code> [3]  ⍝ All interrogations as well as the ability to edit the file can be supressed by passing a 0 as ⍺ ("quiet").</code>
<code> [4]  ⍝ Also, there is no option to overwrite or merge, it's always merge then.</code>
<code> [5]   quiet←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'quiet'</code>
<code> [6]   r←'AddGitIgnore: no action taken'</code>
<code> [7]   (space path)←EstablishProject y</code>
<code> [8]   →(0=≢space,path)/0</code>
<code> [9]   :If quiet</code>
<code> [10]  :OrIf CommTools.YesOrNo'Add .gitignore for APLers to ',path,' ?'</code>
<code> [11]      buff←'aplcore' 'CONTINUE.dws' 'conga.crash'</code>
<code> [12]      :If 0&lt;≢space</code>
<code> [13]          ref←⍎space</code>
<code> [14]          cfg←⎕JSON⍠('Dialect' 'JSON5')⊣⊃F.NGET ref.CiderConfig.HOME,'/cider.config'</code>
<code> [15]      :AndIf 0&lt;≢cfg.CIDER.tatinFolder</code>
<code> [16]          installFolders←{1⊃'='(≠⊆⊢)⍵}¨','(≠⊆⊢)cfg.CIDER.tatinFolder</code>
<code> [17]          installFolders←{⍵,(~(¯1↑⍵)∊'/\')/'/'}¨installFolders</code>
<code> [18]          q←'Install folders: ',⊃{⍺,'/ and ',⍵,'/'}/installFolders</code>
<code> [19]          q,←(⎕UCS 13),'  Add special statements for them?'</code>
<code> [20]          :If quiet</code>
<code> [21]          :OrIf CommTools.YesOrNo q</code>
<code> [22]              buff,←⊃,/{r←''</code>
<code> [23]                  r,←⊂'/',⍵,'*'</code>
<code> [24]                  r,←⊂'!/',⍵,'apl-dependencies.txt'</code>
<code> [25]                  r,←⊂'!/',⍵,'apl-buildlist.json'</code>
<code> [26]                  r</code>
<code> [27]              }¨installFolders</code>
<code> [28]          :EndIf</code>
<code> [29]      :EndIf</code>
<code> [30]      :If ⎕NEXISTS path,'/.gitignore'</code>
<code> [31]          :If quiet</code>
<code class="emphasize">→[32]              ind←2          ⍝ Merge</code>
<code> [33]          :Else</code>
<code> [34]              ind←('Select desired action on ',path,'/.gitignore')0 1 CommTools.Select'Replace' 'Merge' 'Quit'</code>
<code> [35]          :EndIf</code>
<code> [36]          →(ind=3)/0</code>
<code> [37]          :If ind=2</code>
<code> [38]              buff←∪(⊃F.NGET(path,'/.gitignore')1),buff</code>
<code> [39]          :EndIf</code>
<code> [40]      :EndIf</code>
<code> [41]      :If ~quiet</code>
<code> [42]          ref←⎕NS''</code>
<code> [43]          ref.gitIgnore←buff</code>
<code> [44]          ref.⎕ED'gitIgnore'</code>
<code> [45]          buff←ref.gitIgnore</code>
<code> [46]          →(0=≢' '~⍨∊buff)/0</code>
<code> [47]      :EndIf</code>
<code> [48]      (⊂buff)F.NPUT(path,'/.gitignore')1</code>
<code> [49]      r←'.gitignore created in ',path</code>
<code> [50]  :EndIf</code>
</div>
<code class="header" id="listing_28">#.APLGit2.APLGit2.U.RunProcess &mdash; 98%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←RunProcess(EXE command)</code>
<code> [1]  ⍝ Runs EXE and returns a namespace with all sorts of variables, among them StdOut and StdErr.</code>
<code> [2]  ⍝ Requires .NET under Windows but not elsewhere.</code>
<code> [3]  ⍝ Cannot run in elevated mode because for that we would need to set i.Verb to 'runas' which</code>
<code> [4]  ⍝ we can't because "UseShellEexecute" must be set to 1 for this which we can't because we must</code>
<code> [5]  ⍝ redirect StdOut and StdErr, something we can only do with "UseShellExecute←0"</code>
<code> [6]  ⍝ ⍵[0] ←→ Executable</code>
<code> [7]  ⍝ ⍵[1] ←→ Argument</code>
<code> [8]   r←⎕NS''</code>
<code> [9]   :If 'Win'≡A.GetOperatingSystem ⍬</code>
<code> [10]      ⎕IO←0</code>
<code> [11]      ⎕USING←'System' 'System.IO' 'System.Diagnostics,System.dll'</code>
<code> [12]      p←⎕NEW Process</code>
<code> [13]      i←p.StartInfo</code>
<code> [14]      i.FileName←EXE</code>
<code> [15]      i.Arguments←command</code>
<code> [16]      i.RedirectStandardOutput←1</code>
<code> [17]      i.RedirectStandardInput←1</code>
<code> [18]      i.RedirectStandardError←1</code>
<code> [19]      i.UseShellExecute←0</code>
<code> [20]      i.CreateNoWindow←1</code>
<code> [21]      {}p.Start ⍬</code>
<code> [22]      re←⎕NEW StreamReader p.StandardError.BaseStream</code>
<code> [23]      ro←⎕NEW StreamReader p.StandardOutput.BaseStream</code>
<code> [24]      t←r{⍺.StdErr←⍵.ReadToEnd}&amp;re</code>
<code> [25]      r.StdOut←ro.ReadToEnd</code>
<code> [26]      op←{6::0 ⋄ z←⍺⍺ ⍵}</code>
<code> [27]      {}p.WaitForExit op ⍬</code>
<code> [28]      {}⎕TSYNC op t</code>
<code> [29]      r.ExitCode←p.ExitCode</code>
<code> [30]      rtc←{' '@((⎕UCS 9)∘=)⍵}</code>
<code> [31]      pfn←{⍵⊆⍨~⍵∊⎕UCS 10 13}</code>
<code> [32]      r.StdOut←pfn rtc r.StdOut</code>
<code> [33]      r.StdErr←pfn rtc r.StdErr</code>
<code> [34]  :Else</code>
<code> [35]      ⎕IO←1</code>
<code> [36]      r←⎕NS''</code>
<code> [37]      r.ExitCode←0</code>
<code> [38]      r.StdErr←r.StdOut←''</code>
<code> [39]      folder←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'folder'</code>
<code> [40]      tfn←##.F.GetTempFilename2'APLGit'   ⍝ Temp FileName</code>
<code> [41]      cmd←EXE,' ',command,' 2&gt;"',tfn,'"'</code>
<code> [42]      :Trap 11</code>
<code> [43]          buff←⎕SH cmd</code>
<code> [44]      :Else</code>
<code> [45]          dmx←⎕DMX</code>
<code> [46]          r.ExitCode←1</code>
<code> [47]          r.StdErr←dmx.Message</code>
<code> [48]          :If ∨/'code 127 '⍷dmx.Message,' '</code>
<code class="emphasize">→[49]              r.ExitCode←127</code>
<code> [50]          :ElseIf ∨/'code 128 '⍷dmx.Message,' '</code>
<code> [51]              r.ExitCode←128</code>
<code> [52]          :EndIf</code>
<code> [53]          :Return</code>
<code> [54]      :EndTrap</code>
<code> [55]      r.StdOut←{'UTF-8'⎕UCS ⎕UCS ⍵}¨buff</code>
<code> [56]      :If 0&lt;≢msg←{22::'' ⋄ ⊃⎕NGET ⍵ 1}tfn</code>
<code> [57]          r.StdErr←⊃{⍺,' ',⍵}/msg</code>
<code> [58]      :EndIf</code>
<code> [59]      ##.F.DeleteFile tfn</code>
<code> [60]  :EndIf</code>
</div>
<code class="header" id="listing_29">#.APLGit2.APLGit2.Add &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{filter}Add y</code>
<code> [1]  ⍝ Stage all files according to `filter` which defaults to ".".\\</code>
<code> [2]  ⍝ Alternatively you may specify a specific file, or a RegEx as filter that catches a number of files etc.\\</code>
<code> [3]  ⍝ `y` must be one of:</code>
<code> [4]  ⍝   * Fully qualfied name of a namespace that is an opened Cider project</code>
<code> [5]  ⍝   * Fully qualified path to a Git-managed project</code>
<code> [6]  ⍝ Returns a 0</code>
<code> [7]   filter←{0&lt;⎕NC ⍵:⍎⍵ ⋄ '.'}' filter'</code>
<code> [8]   r←0</code>
<code> [9]   (space path)←EstablishProject y</code>
<code> [10]  'No filter specified?!'⎕SIGNAL 11/⍨0=≢filter</code>
<code> [11]  (rc msg buff)←path U.RunGitCommand'add ',filter</code>
<code> [12]  msg U.Assert 0=rc</code>
<code> [13] ⍝Done</code>
</div>
<code class="header" id="listing_30">#.APLGit2.APLGit2.Branch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←{option}Branch y</code>
<code> [1] ⍝ This is just a synonym for the `ListBranches` function.</code>
<code> [2] ⍝ Invented to stay in line with the Git commands</code>
<code> [3]  ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [4]  option←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'option'</code>
<code> [5]  r←option ListBranches y</code>
<code> [6] ⍝Done</code>
</div>
<code class="header" id="listing_31">#.APLGit2.APLGit2.CurrentBranch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←CurrentBranch y</code>
<code> [1]  ⍝ Returns the name of the current branch for `y`.\\</code>
<code> [2]  ⍝ For what `y` can actually be see `EstablishProject`.\\</code>
<code> [3]   ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [4]   (space folder)←EstablishProject y</code>
<code> [5]   buff←Status folder</code>
<code> [6]   msg←2⊃buff</code>
<code> [7]   :If 2=⍴⍴msg</code>
<code> [8]       r←'On branch '{{⍵↑⍨¯1+⍵⍳' '}⍵↓⍨¯1+(≢⍺)+1⍳⍨⍺⍷⍵}msg[2;]</code>
<code> [9]   :Else</code>
<code> [10]      r←(≢'On branch ')↓msg</code>
<code> [11]  :EndIf</code>
<code> [12] ⍝Done</code>
</div>
<code class="header" id="listing_32">#.APLGit2.APLGit2.Diff &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{verbose}Diff y</code>
<code> [1]  ⍝ Returns a list with all APL objects/files that are different compared with HEAD.</code>
<code> [2]  ⍝ r is a matrix with two columns and zero or more rows.</code>
<code> [3]  ⍝ If `verbose` is 1 (default is 0) then a full report is returned instead.</code>
<code> [4]  ⍝ `y` must be one of:</code>
<code> [5]  ⍝   * Fully qualfied name of a namespace  that is an opened Cider project</code>
<code> [6]  ⍝   * Fully qualified path to a Git-managed project</code>
<code> [7]  ⍝ `verbose` defaults to 0 which gives you a short report.</code>
<code> [8]   ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [9]   verbose←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'verbose'</code>
<code> [10]  (space folder)←EstablishProject y</code>
<code> [11]  :If verbose</code>
<code> [12]      (rc more r)←folder U.RunGitCommand'diff HEAD'</code>
<code> [13]      more U.Assert 0=rc</code>
<code> [14]  :Else</code>
<code> [15]      (rc more buff)←folder U.RunGitCommand'diff HEAD --name-only'</code>
<code> [16]      more U.Assert 0=rc</code>
<code> [17]      r←(⎕SE.Link.GetItemName(⊂folder,'/'),¨buff),[1.5]buff</code>
<code> [18]  :EndIf</code>
<code> [19] ⍝Done</code>
</div>
<code class="header" id="listing_33">#.APLGit2.APLGit2.GetLastCommit &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> hash←GetLastCommit folder</code>
<code> [1] ⍝ Returns the last commit.</code>
<code> [2] ⍝ Useful to compare it with the working tree</code>
<code> [3]  parms←⎕NS''</code>
<code> [4]  parms.max←1</code>
<code> [5]  commit←parms Log folder</code>
<code> [6]  hash←⊃commit</code>
<code> [7] ⍝Done</code>
</div>
<code class="header" id="listing_34">#.APLGit2.APLGit2.GetMainOrMaster &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetMainOrMaster folder</code>
<code> [1] ⍝ Returns either "master" (now deprecated but still valid) or "main"</code>
<code> [2]  r←'main' 'master'⊃⍨⍸'main' 'master'∊2↓¨ListBranches folder</code>
</div>
<code class="header" id="listing_35">#.APLGit2.APLGit2.GetMostRecentAncestor &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetMostRecentAncestor y</code>
<code> [1]  ⍝</code>
<code> [2]   r←''</code>
<code> [3]   (space folder)←EstablishProject y</code>
<code> [4]   →(0=≢folder)/0</code>
<code> [5]   branch1←CurrentBranch folder</code>
<code> [6]   'Without ⍺ the current branch must not be either "main" or "master"'U.Assert~(⊂branch1)∊'main' 'master'</code>
<code> [7]   branches←2↓¨ListBranches folder</code>
<code> [8]   branches~←⊂branch1</code>
<code> [9]   branch2←(⌊/branches⍳'main' 'master')⊃branches</code>
<code> [10]  (rc msg data)←folder U.RunGitCommand'merge-base ',branch1,' ',branch2</code>
<code> [11]  msg U.Assert 0=rc</code>
<code> [12]  r←⊃data</code>
<code> [13]  ⍝Done</code>
</div>
<code class="header" id="listing_36">#.APLGit2.APLGit2.GitProjects &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GitProjects dummy</code>
<code> [1] ⍝ Returns all open Cider projects that are Git managed.\\</code>
<code> [2]  :If 0≠≢r←⎕SE.Cider.ListOpenProjects 0</code>
<code> [3]      r←(IsGitProject¨r[;2])⌿r</code>
<code> [4]  :EndIf</code>
<code> [5] ⍝Done</code>
</div>
<code class="header" id="listing_37">#.APLGit2.APLGit2.IsDirty &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←IsDirty y</code>
<code> [1]  ⍝ Returns 0, 1, 2 or 3</code>
<code> [2]  ⍝ * 0 means "clean"</code>
<code> [3]  ⍝ * 1 means there are just uncommitted files</code>
<code> [4]  ⍝ * 2 means there are just unstaged files</code>
<code> [5]  ⍝ * 4 means there are just untracked files</code>
<code> [6]  ⍝ * Other numbers are the sum of these</code>
<code> [7]  ⍝ Use `Status` to find out details.\\</code>
<code> [8]  ⍝ For what `y` can actually be see `EstablishProject`.\\</code>
<code> [9]   project←EstablishProject y</code>
<code> [10]  'Not a Cider project'⎕SIGNAL 6/⍨0=≢project</code>
<code> [11]  path←2⊃project</code>
<code> [12]  (rc more buff)←path U.RunGitCommand'status --porcelain'</code>
<code> [13]  more U.Assert 0=rc</code>
<code> [14]  r←0&lt;≢buff</code>
<code> [15] ⍝Done</code>
</div>
<code class="header" id="listing_38">#.APLGit2.APLGit2.IsGitInstalled &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  yesNo←IsGitInstalled</code>
<code> [1]  ⍝ Checks the PATH variable of the current operating system and tries to find the git executable.</code>
<code> [2]   yesNo←0</code>
<code> [3]   :If 'Win'≡A.GetOperatingSystem ⍬</code>
<code> [4]       path←⊃⎕SH'echo %PATH%'</code>
<code> [5]       path←';'(≠⊆⊢)path</code>
<code> [6]       exeName←'git.exe'</code>
<code> [7]   :Else</code>
<code> [8]       path←⊃⎕SH'echo $PATH'</code>
<code> [9]       path←':'(≠⊆⊢)path</code>
<code> [10]      exeName←'git'</code>
<code> [11]  :EndIf</code>
<code> [12]  :If 0&lt;≢path</code>
<code> [13]      yesNo←∨/F.IsFile F.NormalizePath¨(⊂'/',exeName),⍨¨path</code>
<code> [14]  :EndIf</code>
</div>
<code class="header" id="listing_39">#.APLGit2.APLGit2.IsGitProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←IsGitProject path</code>
<code> [1] ⍝ Returns a Boolean indicating whether `path` is Git-managed or not.\\</code>
<code> [2] ⍝ Checks whether `path` has a sub-folder `.git` - that indicates a Git-managed project.\\</code>
<code> [3] ⍝ Is not limited to opened Cider projects.</code>
<code> [4]  path←{0=≢⍵:F.PWD ⋄ ⍵}path</code>
<code> [5]  'No directory provided'⎕SIGNAL 6/⍨0=F.IsDir path</code>
<code> [6]  r←F.IsDir path,'/.git'</code>
<code> [7] ⍝Done</code>
</div>
<code class="header" id="listing_40">#.APLGit2.APLGit2.ListBranches &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{option}ListBranches y</code>
<code> [1]  ⍝ Returns a vector of vector with branch names (the current branch starts with "\* ") or ''.\\</code>
<code> [2]  ⍝ `options might be either -a ("all") or -r ("remote"); there is no default.</code>
<code> [3]  ⍝ `y` must be one of:</code>
<code> [4]  ⍝   * Fully qualfied name of a namespace  that is an opened Cider project</code>
<code> [5]  ⍝   * Fully qualified path to a Git-managed project</code>
<code> [6]   ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [7]   option←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'option'</code>
<code> [8]   (space path)←EstablishProject y</code>
<code> [9]   'Invalid left argument: must be empty or "a" (all) or "r" (remote)'U.Assert(⊂option)∊''⍬'a' 'r' '-a' '-r'</code>
<code> [10]  (rc more buff)←path U.RunGitCommand('branch --list',{0=≢⍵:⍵ ⋄ ' -',⍵~'-'}option)</code>
<code> [11]  more U.Assert 0=rc</code>
<code> [12]  r←{⍵/⍨0&lt;≢¨⍵}⍣(0≠≢buff)⊣buff</code>
<code> [13] ⍝Done</code>
</div>
<code class="header" id="listing_41">#.APLGit2.APLGit2.LogForBranch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←{x}LogForBranch branch</code>
<code> [1] ⍝ Cover for `Log` that returns the log just for a specific branch.</code>
<code> [2] ⍝ For what `x` can actually be see `EstablishProject`.</code>
<code> [3]  x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'x'</code>
<code> [4]  (space folder)←EstablishProject x</code>
<code> [5]  parms←⎕NS''</code>
<code> [6]  parms.branch←branch</code>
<code> [7]  r←parms Log folder</code>
<code> [8] ⍝Done</code>
</div>
<code class="header" id="listing_42">#.APLGit2.APLGit2.Methods &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←Methods</code>
<code> [1]  ⍝ Like `Public` but adds the first line after the header and syntax information.\\</code>
<code> [2]  ⍝ Uses `Public` as source.</code>
<code> [3]   list←Public~⊂'Methods'</code>
<code> [4]   buff←{2↑⎕NR ⍵}¨list</code>
<code> [5]   r←{⍵↑⍨¯1+⍵⍳';'}¨1⊃¨buff</code>
<code> [6]   r←list{⍺ ⎕R' ∇'⊣⍵}¨r</code>
<code> [7]   r←'← ∇'⎕R'←∇'⊣r</code>
<code> [8]   r←list,[1.5]r</code>
<code> [9]   r,←{(¯2×'\\'∘≡¨¯2↑¨⍵)↓¨2↓¨⍵}2⊃¨buff</code>
<code> [10] ⍝Done</code>
</div>
<code class="header" id="listing_43">#.APLGit2.APLGit2.Public &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←Public</code>
<code> [1]   r←''</code>
<code> [2]   r,←⊂'Add'</code>
<code> [3]   r,←⊂'AddGitIgnore'</code>
<code> [4]   r,←⊂'Branch'</code>
<code> [5]   r,←⊂'ChangeLog'</code>
<code> [6]   r,←⊂'Commit'</code>
<code> [7]   r,←⊂'CompareCommits'</code>
<code> [8]   r,←⊂'CurrentBranch'</code>
<code> [9]   r,←⊂'Diff'</code>
<code> [10]  r,←⊂'EstablishProject'</code>
<code> [11]  r,←⊂'GetDefaultProject'</code>
<code> [12]  r,←⊂'GetPathFromProject'</code>
<code> [13]  r,←⊂'GetProjectFromPath'</code>
<code> [14]  r,←⊂'GetTagOfLatestRelease'</code>
<code> [15]  r,←⊂'GoToGitHub'</code>
<code> [16]  r,←⊂'Init'</code>
<code> [17]  r,←⊂'IsDirty'</code>
<code> [18]  r,←⊂'IsGitProject'</code>
<code> [19]  r,←⊂'IsGitInstalled'</code>
<code> [20]  r,←⊂'ListBranches'</code>
<code> [21]  r,←⊂'Log'</code>
<code> [22]  r,←⊂'Methods'</code>
<code> [23]  r,←⊂'OpenGitShell'</code>
<code> [24]  r,←⊂'RefLog'</code>
<code> [25]  r,←⊂'SetDefaultProject'</code>
<code> [26]  r,←⊂'Squash'</code>
<code> [27]  r,←⊂'Status'</code>
<code> [28]  r,←⊂'Version'</code>
</div>
<code class="header" id="listing_44">#.APLGit2.APLGit2.RefLog &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{x}RefLog restrictFlag</code>
<code> [1]  ⍝ Execute Git's "reflog" command.</code>
<code> [2]  ⍝ Returns a matrix with zero or more rows and these columns</code>
<code> [3]  ⍝ [1] Hash</code>
<code> [4]  ⍝ [2] Symbolic pointer (HEAD)</code>
<code> [5]  ⍝ [3] Command</code>
<code> [6]  ⍝ [4] Message, either from the user of from Git</code>
<code> [7]  ⍝ `restrictFlag` defaults to 0 when empty; this lists all entries.</code>
<code> [8]  ⍝ If this is 1 then only the entries up to the last checkout are listed.</code>
<code> [9]  ⍝ For what `x` can actually be see `EstablishProject`.\\</code>
<code> [10]  r←⍬</code>
<code> [11]  x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'x'</code>
<code> [12]  restrictFlag←{0=≢⍵:0 ⋄ ⍵}restrictFlag</code>
<code> [13]  'Right argument must be a Boolean'U.Assert(⊂restrictFlag)∊0 1</code>
<code> [14]  (space folder)←EstablishProject x</code>
<code> [15]  (rc more buff)←folder U.RunGitCommand'reflog '</code>
<code> [16]  ('RefLog crashed with RC=',(⍕rc),'; ',∊more)U.Assert 0=rc</code>
<code> [17]  r←↑3{⍺{(⍺↑⍵),{⍺,' ',⍵}/⍺↓⍵}' '(≠⊆⊢)⍵}¨buff</code>
<code> [18]  :If restrictFlag</code>
<code> [19]      r←(¯1+r[;3]⍳⊂'checkout:')↑r</code>
<code> [20]  :EndIf</code>
<code> [21] ⍝Done</code>
</div>
<code class="header" id="listing_45">#.APLGit2.APLGit2.Status &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{short}Status y</code>
<code> [1]  ⍝ Reports all unstaged/uncommited/untracked files.\\</code>
<code> [2]  ⍝ `y` must be one of:</code>
<code> [3]  ⍝   * Fully qualfied name of a namespace that is an opened Cider project</code>
<code> [4]  ⍝   * Fully qualified path to a Git-managed project</code>
<code> [5]  ⍝ `short` defaults to 0 which gives you a detailed report while 1 gives a short report.</code>
<code> [6]   ⎕TRAP←(811 'E' '⎕DMX.EM ⎕signal 811')(0 'N')</code>
<code> [7]   short←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'short'</code>
<code> [8]   (space path)←EstablishProject y</code>
<code> [9]   (rc more r)←path U.RunGitCommand('status',short/' --short')</code>
<code> [10]  more U.Assert 0=rc</code>
<code> [11]  :If ~short</code>
<code> [12]      ind←⍸∨/¨'On branch'∘⍷¨r</code>
<code> [13]      branch←⊃¯1↑' '(≠⊆⊢)ind⊃r</code>
<code> [14]      :If (⊂branch)∊'main' 'master'</code>
<code> [15]          msg←U.Box{⍵{(⍵⍴'⌹')⍺(⍵⍴'⌹')}≢⍵}'⌹ On branch ',branch,' ⌹'</code>
<code> [16]      :Else</code>
<code> [17]          msg←'On branch ',branch</code>
<code> [18]      :EndIf</code>
<code> [19]      (ind⊃r)←msg</code>
<code> [20]  :EndIf</code>
<code> [21]  r←(⊂space),⊆r</code>
<code> [22] ⍝Done</code>
</div>
<code class="header" id="listing_46">#.APLGit2.APLGit2.Version &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Version</code>
<code> [1] ⍝ See also `History`</code>
<code> [2]  r←'0.11.0+216'</code>
</div>
<code class="header" id="listing_47">#.APLGit2.APLGit2.API.Add &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Add←{⍺←⊢ ⋄ 1:shy←⍺ ##.Add ⍵}</code>
</div>
<code class="header" id="listing_48">#.APLGit2.APLGit2.API.AddGitIgnore &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AddGitIgnore←{⍺←⊢ ⋄ ⍺ ##.AddGitIgnore ⍵}</code>
</div>
<code class="header" id="listing_49">#.APLGit2.APLGit2.API.Branch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Branch←{⍺←⊢ ⋄ ⍺ ##.Branch ⍵}</code>
</div>
<code class="header" id="listing_50">#.APLGit2.APLGit2.API.ChangeLog &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ChangeLog←{⍺←⊢ ⋄ ⍺ ##.ChangeLog ⍵}</code>
</div>
<code class="header" id="listing_51">#.APLGit2.APLGit2.API.Commit &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Commit←{⍺←⊢ ⋄ ⍺ ##.Commit ⍵}</code>
</div>
<code class="header" id="listing_52">#.APLGit2.APLGit2.API.CompareCommits &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CompareCommits←{⍺←⊢ ⋄ ⍺ ##.CompareCommits ⍵}</code>
</div>
<code class="header" id="listing_53">#.APLGit2.APLGit2.API.CurrentBranch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CurrentBranch←{##.CurrentBranch ⍵}</code>
</div>
<code class="header" id="listing_54">#.APLGit2.APLGit2.API.Diff &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Diff←{⍺←⊢ ⋄ ⍺ ##.Diff ⍵}</code>
</div>
<code class="header" id="listing_55">#.APLGit2.APLGit2.API.EstablishProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EstablishProject←{⍺←⊢ ⋄ ⍺ ##.EstablishProject ⍵}</code>
</div>
<code class="header" id="listing_56">#.APLGit2.APLGit2.API.GetDefaultProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetDefaultProject←{##.GetDefaultProject ⍵}</code>
</div>
<code class="header" id="listing_57">#.APLGit2.APLGit2.API.GetPathFromProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetPathFromProject←{##.GetPathFromProject ⍵}</code>
</div>
<code class="header" id="listing_58">#.APLGit2.APLGit2.API.GetProjectFromPath &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetProjectFromPath←{##.GetProjectFromPath ⍵}</code>
</div>
<code class="header" id="listing_59">#.APLGit2.APLGit2.API.GetTagOfLatestRelease &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetTagOfLatestRelease←{⍺←⊢ ⋄ ⍺ ##.GetTagOfLatestRelease ⍵}</code>
</div>
<code class="header" id="listing_60">#.APLGit2.APLGit2.API.GoToGitHub &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GoToGitHub←{1:shy←##.GoToGitHub ⍵}</code>
</div>
<code class="header" id="listing_61">#.APLGit2.APLGit2.API.Init &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Init←{⍺←⊢ ⋄ ⍺ ##.Init ⍵}</code>
</div>
<code class="header" id="listing_62">#.APLGit2.APLGit2.API.IsDirty &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> IsDirty←{##.IsDirty ⍵}</code>
</div>
<code class="header" id="listing_63">#.APLGit2.APLGit2.API.IsGitProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> IsGitProject←{##.IsGitProject ⍵}</code>
</div>
<code class="header" id="listing_64">#.APLGit2.APLGit2.API.ListBranches &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ListBranches←{⍺←⊢ ⋄ ⍺ ##.ListBranches ⍵}</code>
</div>
<code class="header" id="listing_65">#.APLGit2.APLGit2.API.Log &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Log←{⍺←⊢ ⋄ ⍺ ##.Log ⍵}</code>
</div>
<code class="header" id="listing_66">#.APLGit2.APLGit2.API.OpenGitShell &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OpenGitShell←{1:shy←##.OpenGitShell ⍵}</code>
</div>
<code class="header" id="listing_67">#.APLGit2.APLGit2.API.RefLog &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> RefLog←{⍺←⊢ ⋄ ⍺ ##.RefLog ⍵}</code>
</div>
<code class="header" id="listing_68">#.APLGit2.APLGit2.API.SetDefaultProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetDefaultProject←{⍺←⊢ ⋄ 1:shy←⍺ ##.SetDefaultProject ⍵}</code>
</div>
<code class="header" id="listing_69">#.APLGit2.APLGit2.API.Squash &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Squash←{⍺←⊢ ⋄ ⍺ ##.Squash ⍵}</code>
</div>
<code class="header" id="listing_70">#.APLGit2.APLGit2.API.Status &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Status←{⍺←⊢ ⋄ ⍺ ##.Status ⍵}</code>
</div>
<code class="header" id="listing_71">#.APLGit2.APLGit2.U.AddSlash &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AddSlash←{⍵,(~(¯1↑⍵)∊'/\')/'/'}</code>
</div>
<code class="header" id="listing_72">#.APLGit2.APLGit2.U.Assert &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Assert←{⍺←'' ⋄ (,1)≡,⍵:r←1 ⋄ ⎕ML←1 ⋄ (∊⍺)⎕SIGNAL 1↓(⊃∊⍵),ErrNo}</code>
</div>
<code class="header" id="listing_73">#.APLGit2.APLGit2.U.Box &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Box←{⍺←⊢</code>
<code> [1]       r←⎕FMT↑⍵</code>
<code> [2]       b←r∊⍺⊣'⌹'</code>
<code> [3]       m←⍉4⊥⍉2⊥↑↑(3,/0,b,0)(3,⌿0⍪b⍪0)</code>
<code> [4]       c←'│  ─  ┌  │  │  └  ├  ─  ┐  ─  ┬  ┘  ┤  ┴  ┼ .'~' '</code>
<code> [5]       n←13 14 15 28 29 30 31 44 45 46 47 60 61 62 63</code>
<code> [6]       (⍴r)⍴(m∊n)⊖(2,⍴r)⍴r⍪(⊂n⍳m)⌷c</code>
<code> [7]  ⍝ box frame</code>
<code> [8]  ⍝ [⍺] char(s) to be replaced - dflt '⌹'</code>
<code> [9]  ⍝  ⍵  char array</code>
<code> [10] ⍝  ←  array with ⍺ replaced by boxing chars</code>
<code> [11] ⍝ ┌───┬───┬───┬───┬───┬───┬───┬───┐  ┌───┬───┬───┬───┬───┬───┬───┬───┐</code>
<code> [12] ⍝ │   │ ∘ │   │ ∘ │   │ ∘ │   │ ∘ │  │   │ │ │   │ │ │   │ │ │   │ │ │</code>
<code> [13] ⍝ │ ∘ │ ∘ │ ∘∘│ ∘∘│ ∘ │ ∘ │ ∘∘│ ∘∘│  │ ∘ │ │ │ ──│ └─│ │ │ │ │ ┌─│ ├─│</code>
<code> [14] ⍝ │   │   │   │   │ ∘ │ ∘ │ ∘ │ ∘ │  │   │   │   │   │ │ │ │ │ │ │ │ │</code>
<code> [15] ⍝ ├───┼───┼───┼───┼───┼───┼───┼───┤  ├───┼───┼───┼───┼───┼───┼───┼───┤</code>
<code> [16] ⍝ │   │ ∘ │   │ ∘ │   │ ∘ │   │ ∘ │  │   │ │ │   │ │ │   │ │ │   │ │ │</code>
<code> [17] ⍝ │∘∘ │∘∘ │∘∘∘│∘∘∘│∘∘ │∘∘ │∘∘∘│∘∘∘│  │── │─┘ │───│─┴─│─┐ │─┤ │─┬─│─┼─│</code>
<code> [18] ⍝ │   │   │   │   │ ∘ │ ∘ │ ∘ │ ∘ │  │   │   │   │   │ │ │ │ │ │ │ │ │</code>
<code> [19] ⍝ └───┴───┴───┴───┴───┴───┴───┴───┘  └───┴───┴───┴───┴───┴───┴───┴───┘</code>
<code> [20] ⍝ Phil Last 2016-02-12</code>
<code> [21]  }</code>
</div>
<code class="header" id="listing_74">#.APLGit2.APLGit2.U.ErrNo &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ErrNo</code>
<code> [1]  r←811</code>
</div>
<code class="header" id="listing_75">#.APLGit2.APLGit2.U.FormatLog &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←FormatLog logData</code>
<code> [1]  ⍝ Formats the Git Log properly when GetLogFormat was used to retrieve the data.</code>
<code> [2]   ⍝ First we transform any multi-line messages into simple ";"-separated ones:</code>
<code> [3]   :If ∨/b←'⍙'∊¨logData</code>
<code> [4]       logData←⊃¨{⍺,';',⍵}/¨(+\b)⊆logData</code>
<code> [5]   :EndIf</code>
<code> [6]   ⍝ Now we split the data appropriately and ridden us of the separator:</code>
<code> [7]   ind←{⍸'⍙'=⍵}¨logData</code>
<code> [8]   b←{∊0,⍨¨(⍵-1+(0,¯1↓⍵))⍴¨⍳3}¨ind</code>
<code> [9]   b,¨←((≢¨logData)-≢¨b)⍴¨4</code>
<code> [10]  r←↑b⊆¨logData</code>
<code> [11] ⍝Done</code>
</div>
<code class="header" id="listing_76">#.APLGit2.APLGit2.U.GetDateFormat &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetDateFormat</code>
<code> [1] ⍝ We define an appropriate date format</code>
<code> [2]  r←'format:"%Y-%m-%d %H:%M:%S"'</code>
</div>
<code class="header" id="listing_77">#.APLGit2.APLGit2.U.GetGitAttributes &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetGitAttributes</code>
<code> [1]  ⍝ Returns a vector of character vectors that define a default file .gitattributes</code>
<code> [2]   r←''</code>
<code> [3]   r,←⊂'# Auto detect text files'</code>
<code> [4]   r,←⊂'* text=auto'</code>
<code> [5]   r,←⊂''</code>
<code> [6]   r,←⊂'*.aplf linguist-language=apl'</code>
<code> [7]   r,←⊂'*.aplo linguist-language=apl'</code>
<code> [8]   r,←⊂'*.aplc linguist-language=apl'</code>
<code> [9]   r,←⊂'*.apln linguist-language=apl'</code>
<code> [10]  r,←⊂'*.apli linguist-language=apl'</code>
<code> [11]  r,←⊂'*.apla linguist-language=apl'</code>
<code> [12]  r,←⊂'*.dws linguist-language=apl'</code>
<code> [13]  r,←⊂'*.dyapp linguist-language=apl'</code>
<code> [14]  r,←⊂'*.dyalog linguist-language=apl'</code>
<code> [15]  r,←⊂''</code>
<code> [16]  r,←⊂'# Exclude these:'</code>
<code> [17]  r,←⊂'Dist/ linguist-vendored=true'</code>
<code> [18]  r,←⊂'CSS/ linguist-vendored=true'</code>
<code> [19]  r,←⊂'Docs/ linguist-vendored=true'</code>
<code> [20]  r,←⊂'Testcases/ linguist-vendored=true'</code>
<code> [21]  r,←⊂'*.js linguist-vendored=true'</code>
<code> [22]  r,←⊂'*.html/ linguist-vendored=true'</code>
<code> [23]  r,←⊂'*.iss/ linguist-vendored=true'</code>
</div>
<code class="header" id="listing_78">#.APLGit2.APLGit2.U.GetLogFormat &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  format←GetLogFormat</code>
<code> [1]  ⍝ Returns a proper format string useful to get what we want from Git's Log.</code>
<code> [2]  </code>
<code> [3]  ⍝SEP←'%x09'                  ⍝ This does not work: arrives as space in APL!</code>
<code> [4]   SEP←'⍙'                     ⍝ Therefore we settle for a very special seperator.</code>
<code> [5]   format←''</code>
<code> [6]   format,←'%h'                ⍝ Commit hash (short; %H would be long)</code>
<code> [7]   format,←SEP</code>
<code> [8]   format,←'%cn'               ⍝ Committer's name</code>
<code> [9]   format,←SEP</code>
<code> [10]  format,←'%cd'               ⍝ Commit date</code>
<code> [11]  format,←SEP</code>
<code> [12]  format,←'%s'                ⍝ Subject</code>
<code> [13] ⍝Done</code>
</div>
<code class="header" id="listing_79">#.APLGit2.APLGit2.U.GetValidFileExtensions &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetValidFileExtensions</code>
<code> [1] ⍝ Returns a vector of text vectors with all the valid file extensions.</code>
<code> [2]  code←'aplf' 'aplo' 'apln' 'aplc' 'apli' 'dyalog'</code>
<code> [3]  arrays←⊆'array'</code>
<code> [4]  r←code,arrays</code>
<code> [5]  ⍝Done</code>
</div>
<code class="header" id="listing_80">#.APLGit2.APLGit2.U.MassageMsg &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> MassageMsg←{</code>
<code> [1] ⍝ This function exchanges all single quotes and all double quotes against ticks (`).</code>
<code> [2] ⍝ Note that under Windows a message MUST NOT be enclosed between single quotes,</code>
<code> [3] ⍝ and that means we cannot escape quotes, so using a substitute is the only way.</code>
<code> [4] ⍝ Having said this, on a Mac (and ONLY the Mac) backticks must be escaped.</code>
<code> [5]      r←'`'@(⍸⍵∊'''"')⊣⍵</code>
<code> [6]      'win'≡⎕C A.GetOperatingSystem ⍬:r</code>
<code> [7]      '`'⎕R'\\`'⊣r  ⍝ Escape backticks, otherwise on a Mac we are in trouble</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_81">#.APLGit2.APLGit2.U.SelectProject &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  SelectProject←{</code>
<code> [1]  ⍝ Presents all currently opened Cider projects and lets the user choose one.\\</code>
<code> [2]  ⍝ Returns a matrix with the selected project in the same format ]Cider.Projects does, possibly `(⍬ ⍬ ⍬)`.</code>
<code> [3]  ⍝ The optional left argument (default=1) allows you to ask for **all** currently opened</code>
<code> [4]  ⍝ projects (rather than only those that are git-managed) by passing a 0.</code>
<code> [5]       ⍺←1</code>
<code> [6]       ~(⊂⍺)∊0 1:'Invalid left argument: not a Boolean'⎕SIGNAL 11</code>
<code> [7]       l←⍵</code>
<code> [8]       0=≢l:l</code>
<code> [9]       0=≢i←'APLGit2: please select a project'##.CommTools.Select↓⎕FMT l:'' ''</code>
<code> [10]      l[i;]</code>
<code> [11]  }</code>
</div>
<div id="footer">
<hr>
<p>Created by "CodeCoverage" version 0.10.2+52 from 2023-04-09</p>
</div>

</body>
</html>
